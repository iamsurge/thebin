
const int  encPin = 2;
const int  photoPin = 3;      
const int ledPin = 13;       // the pin that the LED is attached to

// Variables will change:
long int encClickCounter = 0;   // счетчик количества нажатий кнопок
long int lastEncClickCounter = 0;   // счетчик количества нажатий кнопок
int encState = 0;           // текущее состояние кнопки
int lastEncState = 0;       // предыдущее состояние кнопки
int photoState = 0;         // текущее состояние кнопки
int lastPhotoState = 0;     // предыдущее состояние кнопки
float length=0;

void setup() {
  // инициализируйте контакт кнопки как вход:
  pinMode(encPin, INPUT);
  pinMode(photoPin, INPUT);
  // инициализировать светодиод как выход: 0
  pinMode(ledPin, OUTPUT);
  // инициализировать последовательную связь:
  Serial.begin(9600);
}


void loop() {

  encState = digitalRead(encPin);
  if (encState != lastEncState) {
    if (encState == HIGH) {
      encClickCounter++;
      Serial.println("Enc on");
      Serial.print("number of enc clicks: ");
      Serial.println(encClickCounter);
    } 
 }
  // сохранить текущее состояние как последнее состояние для следующего раза в цикле
  lastEncState = encState;

  photoState = digitalRead(photoPin);
  if (photoState != lastPhotoState) {
    if (photoState == HIGH) {
      Serial.println("Photo mark on");
      Serial.print("Length of paper per photo mark: ");
      Serial.println((float)(encClickCounter-lastEncClickCounter)*0.277777);
      lastEncClickCounter=encClickCounter;
    } else {
      // если текущее состояние НИЗКОЕ, то кнопка переключилась с включенного на выключенное:
      Serial.println("off");
    }
 }
  // сохранить текущее состояние как последнее состояние для следующего раза в цикле
  lastPhotoState = photoState;
  
  // включает светодиод каждые четыре нажатия кнопки, проверяя модуль
  // счетчик нажатий кнопок. функция по модулю дает вам остаток от
  // деление двух чисел:
  if (encClickCounter % 4 == 0) {
    digitalWrite(ledPin, HIGH);
  } else {
    digitalWrite(ledPin, LOW);
  }

}