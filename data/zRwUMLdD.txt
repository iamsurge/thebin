os.loadAPI("json")
local mon = peripheral.wrap("right")
mon.setTextScale(0.5)
main = term.current()
local selected = 0
local searches = {}
local sl = {}
local x, y = mon.getSize()
--local RGB = shell.openTab("RGB.lua") --only works with the rgb program which isn't included
shell.run("monitor","right","clear")
mon.setBackgroundColour(colors.black)
up = 200
down = 208
local offset = {
    x = 1,
    y = 1
}

local xs = offset.x
local ys = offset.y
-----------------------------------------------
function getData(msg)

str = msg:gsub(" ", "-")
local data = http.get("https://www.googleapis.com/customsearch/v1?key=AIzaSyBGild0pQ7K0ls8PT_GF8NnYutTryiqgPc&cx=c3b57b0e6c6ec4470&q=" .. str)
    local searchData = json.decode(data.readAll())
    return searchData
end

function newWindow(data,snip,num)
local gsearch = window.create(mon, 2+xs, 1+ys+num*6/2, x-3-xs, 6)
term.redirect(gsearch)
if num/2 == selected or num/2 == 0.5 then
gsearch.setBackgroundColour(colours.orange)
else
gsearch.setBackgroundColour(colours.black)
end
gsearch.setTextColour(colours.white)
gsearch.clear()
gsearch.setTextColour(colours.red)
print(" "..data)
gsearch.setTextColour(colours.white)
print(" "..snip)
term.redirect(main)
return gsearch
end

function updateselect(wind,data,cal)
term.redirect(wind)
if selected == cal then
wind.setBackgroundColour(colours.orange)
else
wind.setBackgroundColour(colours.black)
end
wind.setTextColour(colours.white)
wind.clear()
wind.setTextColour(colours.red)
print(" "..data.title)
wind.setTextColour(colours.white)
print(" "..data.snippet)
term.redirect(main)
end

while true do
--shell.run("clear")

if(selected == 0) then
local msg = read()
for i, v in pairs(getData(msg).items) do
   selected = 1
   searches[i] = newWindow(v.title,v.snippet,i+i)
   sl[i] = v
    end
end

  local event, button, xt, yt = os.pullEvent( "key" )
  if button == up then
  if selected > 0 then
  selected = selected - 1
  if selected ~= 0 then
  updateselect(searches[selected],sl[selected],selected)
  end
  updateselect(searches[selected+1],sl[selected+1],selected+1)
  end
  elseif button == down then
  if selected < 10 then
  selected = selected + 1
  updateselect(searches[selected],sl[selected],selected)
  updateselect(searches[selected-1],sl[selected-1],selected-1)
  end
  end


end
