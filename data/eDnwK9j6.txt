#!/bin/bash
[[ "$1" ]] || exit 1
[[ -f "$1" ]] || exit 1

app="$(basename ${1%%.tar.gz})"

echo $app

tar -zxf $1 -C /data/data/$app --recursive-unlink --preserve-permissions
#The folders in /data/data each have a different owner. The next line gets the owner and the strips the whitespace
appusername=$(stat -c "%U" /data/data/$app | xargs)

#The next line constructs the chown command to repair the permissions for all the files in the target folder
fixperm="chown -R $appusername:$appusername /data/data/$app/*"

#Display the command to the user
echo "$fixperm"

#Uncomment the next line if you would like the script to fix the permission
eval $fixperm
