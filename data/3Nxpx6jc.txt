#include <stdio.h>

static unsigned char LuckLUT[70][12] = {
	{
		0x02, 0x06, 0x00, 0x04,
		0x01, 0x08, 0x04, 0x00,
		0x03, 0x02, 0x07, 0x06
	},
	{
		0x06, 0x08, 0x09, 0x02,
		0x04, 0x06, 0x00, 0x03,
		0x02, 0x00, 0x04, 0x08
	},
	{
		0x04, 0x09, 0x04, 0x08,
		0x05, 0x00, 0x02, 0x08,
		0x06, 0x02, 0x06, 0x00
	},
	{
		0x05, 0x02, 0x01, 0x00,
		0x06, 0x04, 0x06, 0x02,
		0x08, 0x03, 0x00, 0x04
	},
	{
		0x08, 0x06, 0x02, 0x06,
		0x04, 0x09, 0x04, 0x01,
		0x00, 0x00, 0x08, 0x07
	},
	{
		0x02, 0x03, 0x08, 0x07,
		0x02, 0x06, 0x00, 0x00,
		0x04, 0x08, 0x09, 0x06
	},
	{
		0x01, 0x00, 0x06, 0x08,
		0x09, 0x08, 0x02, 0x04,
		0x00, 0x06, 0x02, 0x04
	},
	{
		0x08, 0x04, 0x00, 0x06,
		0x04, 0x02, 0x03, 0x06,
		0x02, 0x01, 0x08, 0x05
	},
	{
		0x00, 0x08, 0x06, 0x01,
		0x02, 0x07, 0x08, 0x04,
		0x09, 0x00, 0x06, 0x02
	},
	{
		0x06, 0x00, 0x04, 0x02,
		0x08, 0x06, 0x09, 0x02,
		0x08, 0x04, 0x01, 0x00
	},
	{
		0x00, 0x04, 0x02, 0x03,
		0x02, 0x00, 0x08, 0x05,
		0x06, 0x08, 0x04, 0x06
	},
	{
		0x08, 0x06, 0x05, 0x02,
		0x04, 0x08, 0x04, 0x00,
		0x02, 0x09, 0x00, 0x03
	},
	{
		0x04, 0x05, 0x08, 0x06,
		0x07, 0x00, 0x01, 0x02,
		0x00, 0x04, 0x08, 0x02
	},
	{
		0x02, 0x00, 0x04, 0x04,
		0x08, 0x05, 0x00, 0x07,
		0x08, 0x06, 0x02, 0x09
	},
	{
		0x00, 0x04, 0x03, 0x09,
		0x04, 0x06, 0x02, 0x08,
		0x02, 0x00, 0x06, 0x08
	},
	{
		0x03, 0x08, 0x06, 0x00,
		0x08, 0x04, 0x04, 0x02,
		0x06, 0x02, 0x05, 0x00
	},
	{
		0x06, 0x02, 0x07, 0x08,
		0x00, 0x02, 0x05, 0x04,
		0x01, 0x00, 0x04, 0x08
	},
	{
		0x08, 0x06, 0x00, 0x05,
		0x06, 0x04, 0x02, 0x00,
		0x08, 0x04, 0x03, 0x02
	},
	{
		0x07, 0x00, 0x02, 0x04,
		0x02, 0x03, 0x08, 0x06,
		0x05, 0x08, 0x06, 0x04
	},
	{
		0x02, 0x01, 0x04, 0x08,
		0x03, 0x02, 0x06, 0x08,
		0x04, 0x07, 0x00, 0x06
	},
	{
		0x04, 0x00, 0x06, 0x04,
		0x05, 0x00, 0x08, 0x09,
		0x08, 0x02, 0x06, 0x07
	},
	{
		0x00, 0x07, 0x02, 0x08,
		0x04, 0x02, 0x05, 0x00,
		0x09, 0x06, 0x08, 0x06
	},
	{
		0x08, 0x04, 0x00, 0x06,
		0x02, 0x01, 0x08, 0x06,
		0x04, 0x05, 0x02, 0x00
	},
	{
		0x06, 0x02, 0x08, 0x01,
		0x00, 0x08, 0x00, 0x02,
		0x03, 0x06, 0x04, 0x04
	},
	{
		0x04, 0x06, 0x09, 0x00,
		0x08, 0x07, 0x02, 0x06,
		0x02, 0x04, 0x00, 0x01
	},
	{
		0x06, 0x08, 0x04, 0x02,
		0x09, 0x00, 0x06, 0x04,
		0x00, 0x01, 0x08, 0x02
	},
	{
		0x05, 0x04, 0x06, 0x00,
		0x06, 0x02, 0x04, 0x01,
		0x08, 0x02, 0x00, 0x08
	},
	{
		0x00, 0x06, 0x00, 0x07,
		0x08, 0x09, 0x02, 0x04,
		0x02, 0x08, 0x01, 0x06
	},
	{
		0x02, 0x05, 0x08, 0x04,
		0x00, 0x04, 0x03, 0x02,
		0x00, 0x09, 0x06, 0x08
	},
	{
		0x09, 0x02, 0x05, 0x02,
		0x04, 0x06, 0x00, 0x08,
		0x06, 0x00, 0x07, 0x04
	},
	{
		0x06, 0x02, 0x00, 0x04,
		0x07, 0x00, 0x01, 0x04,
		0x08, 0x02, 0x08, 0x09
	},
	{
		0x02, 0x06, 0x01, 0x08,
		0x02, 0x03, 0x06, 0x09,
		0x00, 0x08, 0x04, 0x00
	},
	{
		0x03, 0x00, 0x02, 0x06,
		0x08, 0x04, 0x08, 0x06,
		0x01, 0x04, 0x09, 0x02
	},
	{
		0x02, 0x04, 0x03, 0x00,
		0x02, 0x06, 0x09, 0x00,
		0x08, 0x01, 0x04, 0x08
	},
	{
		0x01, 0x08, 0x06, 0x02,
		0x06, 0x04, 0x02, 0x03,
		0x04, 0x00, 0x05, 0x00
	},
	{
		0x04, 0x03, 0x04, 0x08,
		0x00, 0x06, 0x00, 0x08,
		0x05, 0x06, 0x02, 0x02
	},
	{
		0x08, 0x04, 0x02, 0x05,
		0x06, 0x00, 0x07, 0x02,
		0x04, 0x03, 0x00, 0x06
	},
	{
		0x07, 0x08, 0x00, 0x02,
		0x03, 0x02, 0x06, 0x00,
		0x06, 0x04, 0x08, 0x04
	},
	{
		0x00, 0x02, 0x04, 0x06,
		0x00, 0x08, 0x04, 0x07,
		0x02, 0x08, 0x06, 0x03
	},
	{
		0x02, 0x01, 0x08, 0x03,
		0x04, 0x05, 0x08, 0x06,
		0x00, 0x06, 0x02, 0x04
	},
	{
		0x06, 0x07, 0x00, 0x04,
		0x00, 0x02, 0x08, 0x02,
		0x06, 0x04, 0x08, 0x05
	},
	{
		0x02, 0x08, 0x09, 0x07,
		0x06, 0x00, 0x05, 0x08,
		0x04, 0x06, 0x04, 0x00
	},
	{
		0x06, 0x00, 0x02, 0x08,
		0x05, 0x08, 0x00, 0x09,
		0x06, 0x04, 0x02, 0x04
	},
	{
		0x04, 0x05, 0x04, 0x06,
		0x08, 0x06, 0x02, 0x00,
		0x09, 0x02, 0x08, 0x01
	},
	{
		0x09, 0x02, 0x08, 0x00,
		0x04, 0x01, 0x06, 0x04,
		0x08, 0x06, 0x00, 0x02
	},
	{
		0x02, 0x06, 0x02, 0x06,
		0x01, 0x08, 0x04, 0x00,
		0x07, 0x08, 0x03, 0x00
	},
	{
		0x00, 0x04, 0x04, 0x02,
		0x08, 0x06, 0x03, 0x06,
		0x00, 0x05, 0x02, 0x07
	},
	{
		0x08, 0x02, 0x07, 0x09,
		0x06, 0x00, 0x04, 0x08,
		0x03, 0x00, 0x04, 0x06
	},
	{
		0x04, 0x03, 0x08, 0x00,
		0x02, 0x04, 0x06, 0x05,
		0x02, 0x07, 0x06, 0x08
	},
	{
		0x05, 0x00, 0x06, 0x04,
		0x00, 0x09, 0x08, 0x06,
		0x04, 0x08, 0x07, 0x02
	},
	{
		0x08, 0x00, 0x01, 0x08,
		0x04, 0x02, 0x00, 0x07,
		0x06, 0x04, 0x06, 0x02
	},
	{
		0x06, 0x09, 0x00, 0x04,
		0x07, 0x08, 0x02, 0x06,
		0x00, 0x03, 0x04, 0x08
	},
	{
		0x07, 0x04, 0x08, 0x08,
		0x00, 0x05, 0x06, 0x04,
		0x02, 0x02, 0x00, 0x06
	},
	{
		0x00, 0x00, 0x04, 0x05,
		0x08, 0x02, 0x07, 0x08,
		0x04, 0x06, 0x02, 0x09
	},
	{
		0x02, 0x08, 0x06, 0x06,
		0x02, 0x04, 0x00, 0x01,
		0x00, 0x08, 0x03, 0x04
	},
	{
		0x01, 0x04, 0x02, 0x04,
		0x06, 0x00, 0x08, 0x06,
		0x05, 0x02, 0x00, 0x08
	},
	{
		0x08, 0x02, 0x00, 0x03,
		0x06, 0x06, 0x02, 0x08,
		0x04, 0x09, 0x04, 0x00
	},
	{
		0x04, 0x08, 0x06, 0x02,
		0x00, 0x03, 0x04, 0x02,
		0x07, 0x08, 0x05, 0x06
	},
	{
		0x00, 0x06, 0x03, 0x06,
		0x02, 0x04, 0x01, 0x04,
		0x08, 0x00, 0x08, 0x05
	},
	{
		0x04, 0x01, 0x08, 0x00,
		0x09, 0x08, 0x06, 0x00,
		0x02, 0x06, 0x02, 0x04
	},
	{
		0x04, 0x08, 0x07, 0x02,
		0x06, 0x08, 0x00, 0x02,
		0x06, 0x04, 0x01, 0x00
	},
	{
		0x00, 0x02, 0x06, 0x08,
		0x03, 0x04, 0x06, 0x04,
		0x02, 0x08, 0x00, 0x01
	},
	{
		0x08, 0x04, 0x05, 0x00,
		0x08, 0x02, 0x04, 0x06,
		0x07, 0x02, 0x06, 0x00
	},
	{
		0x06, 0x09, 0x02, 0x06,
		0x00, 0x08, 0x07, 0x08,
		0x04, 0x00, 0x02, 0x04
	},
	{
		0x09, 0x06, 0x04, 0x00,
		0x02, 0x01, 0x00, 0x05,
		0x08, 0x06, 0x08, 0x02
	},
	{
		0x00, 0x02, 0x08, 0x04,
		0x01, 0x06, 0x04, 0x02,
		0x06, 0x05, 0x00, 0x08
	},
	{
		0x04, 0x00, 0x02, 0x01,
		0x08, 0x00, 0x06, 0x03,
		0x04, 0x02, 0x09, 0x06
	},
	{
		0x03, 0x08, 0x06, 0x02,
		0x04, 0x02, 0x09, 0x00,
		0x00, 0x07, 0x06, 0x08
	},
	{
		0x08, 0x06, 0x00, 0x00,
		0x06, 0x07, 0x08, 0x04,
		0x01, 0x04, 0x02, 0x03
	},
	{
		0x06, 0x07, 0x08, 0x09,
		0x00, 0x04, 0x02, 0x08,
		0x06, 0x00, 0x04, 0x02
	}
};

static unsigned char StarSignDates[12][2] = {
	{ 0x01, 0x13 },
	{ 0x02, 0x12 },
	{ 0x03, 0x14 },
	{ 0x04, 0x13 },
	{ 0x05, 0x14 },
	{ 0x06, 0x15 },
	{ 0x07, 0x16 },
	{ 0x08, 0x16 },
	{ 0x09, 0x16 },
	{ 0x0a, 0x17 },
	{ 0x0b, 0x16 },
	{ 0x0c, 0x15 }
};

typedef struct {
    unsigned int year;
    signed char month;
    signed char day;
    signed char weekday;
    signed char hour;
    signed char minute;
    signed char second;
    signed short unk;
} DateTime;

static DateTime now = {
    2022,
    12,
    19,
    1,
    12,
    35,
    00,
    00
};

#define SUNDAY 0
#define MONDAY 1
#define TUESDAY 2
#define WEDNESDAY 3
#define THURSDAY 4
#define FRIDAY 5
#define SATURDAY 6

static int GetStarSign(int month, int day) {
    int sign = 0;
    while (1) {
        if (month < StarSignDates[sign][0]) {
            return sign;
        }
        
        if (month == StarSignDates[sign][0] && day <= StarSignDates[sign][1]) {
            return sign;
        }
        
        sign++;
        if (sign > 11) {
            return 0;
        }
    }
}

static unsigned char GetLuck(DateTime* date, signed char birthday_month, signed char birthday_day) {
    int y0 = date->year / 10;
    int y1 = y0 / 10;
    
    printf("%d\n", (short)(char)(*((int*)&date->month) >> 16));
    
    int u0 = date->month * 103;
    int u1 = date->day * 103;
    
    int res = ((u1 >> 10) - (u1 >> 31)) + (date->day % 10) + ((u0 >> 10) - (u0 >> 31)) + (date->month % 10) + (y1 / 10) + (y1 * -9) + (y1 / 10) * -10 + date->year + y0 * -9;
    
    if (res > 10) {
        res += (res / 10) * -9;
    }
    
    int base = res - 1; // monday
    switch(date->weekday) {
    case SUNDAY:
        base = res + 59;
        break;
    case TUESDAY:
        base = res + 9;
        break;
    case WEDNESDAY:
        base = res + 19;
        break;
    case THURSDAY:
        base = res + 29;
        break;
    case FRIDAY:
        base = res + 39;
        break;
    case SATURDAY:
        base = res + 49;
        break;
    }
    
    int sign = GetStarSign(birthday_month, birthday_day);
    return LuckLUT[base][sign];
}

int main()
{
    int luck = GetLuck(&now, 1, 16);
    printf("Luck: %d\n", luck);
    return 0;
}
