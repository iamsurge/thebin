#!/bin/bash
#read storage SMART information on Debian 10 "Buster"
#version 2022-10-26 v1.10.26-02:30
#syntax help: https://explainshell.com/

SCRIPT=`basename "$0"`

if [[ $UID != 0 ]]; then
    echo "The installation script has to be run as root"
    echo "Please re-run this script as"
    echo "  sudo ./$SCRIPT"
    exit 1
fi

#storage tools
sudo apt install -y smartmontools lsscsi nvme-cli

#simple list
sudo lsscsi
#simple NVNe list
#https://opensource.com/article/21/9/nvme-cli
sudo nvme list
#detailed table
sudo lsblk -o HCTL,TYPE,VENDOR,MODEL,REV,SERIAL,SIZE,PHY-SEC,LOG-SEC,NAME

#The most comprehensive health status
#━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
#https://linuxconfig.org/retrieve-hard-drive-s-age-and-general-health-information-using-linux
sudo smartctl --xall /dev/sda

#simple SMART table, for NVMe type nvme0 instead of sda
#━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
#https://www.thomas-krenn.com/en/wiki/SMART_Attributes_documentation
#https://www.techrepublic.com/article/using-smartctl-to-get-smart-status-information-on-your-hard-drives/
sudo smartctl -a /dev/sda

#complete SMART table, for NVMe type nvme0 instead of sda
#━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
#https://serverfault.com/questions/951296/finding-smart-status-of-sata-disks-in-hp-smartarray
sudo smartctl -a -l ssd /dev/sda -d sat+cciss,1

#HPE Management Component Pack
#━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
#https://gist.github.com/mrpeardotnet/a9ce41da99936c0175600f484fa20d03
#to get array status:
#sudo ssacli ctrl all show config detail
#subscribe to the mcp repository
#echo "deb http://downloads.linux.hpe.com/SDR/repo/mcp stretch/current non-free" > /etc/apt/sources.list.d/hp-mcp.list
#enroll Hewlett Packard Enterprise keys
#wget -q -O - http://downloads.linux.hpe.com/SDR/hpPublicKey1024.pub | apt-key add -
#wget -q -O - http://downloads.linux.hpe.com/SDR/hpPublicKey2048.pub | apt-key add -
#wget -q -O - http://downloads.linux.hpe.com/SDR/hpPublicKey2048_key1.pub | apt-key add -
#wget -q -O - http://downloads.linux.hpe.com/SDR/hpePublicKey2048_key1.pub | apt-key add -
#curl https://downloads.linux.hpe.com/SDR/hpPublicKey2048.pub | apt-key add -
#curl https://downloads.linux.hpe.com/SDR/hpPublicKey2048_key1.pub | apt-key add -
#curl https://downloads.linux.hpe.com/SDR/hpePublicKey2048_key1.pub | apt-key add -
#update the local apt indexes
#sudo apt-get update
#search for a specific package
#https://downloads.linux.hpe.com/SDR/repo/mcp/pool/non-free/
#install a specific package
#sudo apt-get install -y ssacli ssaducli
