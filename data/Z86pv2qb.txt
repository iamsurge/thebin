## MBBL|12 PREDICTIONS

mbblfixture <- read.csv("~/mbblfixture.csv")

  teams <- c( "ADL", "BNE", "HOB","MELR","MELS", "PTH","SYDS","SYDT")
ratings <- c(  1504,  1448,  1489,  1429,  1495,  1565,  1552,  1518)
 points <- c(     0,     0,     0,     0,     0,     0,     0,     0)
    nrr <- c(     0,     0,     0,     0,     0,     0,     0,     0)

table <- data.frame(ratings, points, nrr)
rownames(table) <- teams

finishes <- data.frame(matrix(nrow = 8, ncol = 10))
rownames(finishes) <- teams
colnames(finishes) <- c(1,2,3,4,5,6,7,8,"GF","Win")
finishes[is.na(finishes)] <- 0

games <- c(1:56)
simcount <- c(1:10000)

for (count in simcount){

    teams <- c( "ADL", "BNE", "HOB","MELR","MELS", "PTH","SYDS","SYDT")
  ratings <- c(  1504,  1448,  1489,  1429,  1495,  1565,  1552,  1518)
   points <- c(     0,     0,     0,     0,     0,     0,     0,     0)
      nrr <- c(     0,     0,     0,     0,     0,     0,     0,     0)
  
  table <- data.frame(ratings, points, nrr)
  rownames(table) <- teams
  
for (val in games){
  gnum <- val
  mbblfixture[gnum, "HomeRating"] <- table[match((mbblfixture[gnum, "Home"]),rownames(table)),"ratings"]
  mbblfixture[gnum, "AwayRating"] <- table[match((mbblfixture[gnum, "Away"]),rownames(table)),"ratings"]
  homewinchance <- (10^(mbblfixture[gnum, "HomeRating"]/400))/((10^(mbblfixture[gnum, "HomeRating"]/400))+(10^(mbblfixture[gnum, "AwayRating"]/400)))
  result <- runif(1)
  margin <- abs(rnorm(1, 0, 0.05))
  if (result < homewinchance){
    table[match(mbblfixture[gnum, "Home"],rownames(table)),"points"] <- table[match(mbblfixture[gnum, "Home"],rownames(table)),"points"] + 2
    table[match(mbblfixture[gnum, "Home"],rownames(table)),"nrr"] <- table[match(mbblfixture[gnum, "Home"],rownames(table)),"nrr"] + margin
    table[match(mbblfixture[gnum, "Away"],rownames(table)),"nrr"] <- table[match(mbblfixture[gnum, "Away"],rownames(table)),"nrr"] - margin
    table[match(mbblfixture[gnum, "Home"],rownames(table)),"ratings"] <- table[match(mbblfixture[gnum, "Home"],rownames(table)),"ratings"] + 20 * (1 - homewinchance)
    table[match(mbblfixture[gnum, "Away"],rownames(table)),"ratings"] <- table[match(mbblfixture[gnum, "Away"],rownames(table)),"ratings"] - 20 * (1 - homewinchance)
  } else {
    table[match(mbblfixture[gnum, "Away"],rownames(table)),"points"] <- table[match(mbblfixture[gnum, "Away"],rownames(table)),"points"] + 2
    table[match(mbblfixture[gnum, "Away"],rownames(table)),"nrr"] <- table[match(mbblfixture[gnum, "Away"],rownames(table)),"nrr"] + margin
    table[match(mbblfixture[gnum, "Home"],rownames(table)),"nrr"] <- table[match(mbblfixture[gnum, "Home"],rownames(table)),"nrr"] - margin
    table[match(mbblfixture[gnum, "Away"],rownames(table)),"ratings"] <- table[match(mbblfixture[gnum, "Away"],rownames(table)),"ratings"] + 20 * (homewinchance)
    table[match(mbblfixture[gnum, "Home"],rownames(table)),"ratings"] <- table[match(mbblfixture[gnum, "Home"],rownames(table)),"ratings"] - 20 * (homewinchance)
  } 
}

table <- table[with(table, order(-points, -nrr)), ]
order <- rownames(table)

mbblfixture[58, "Home"] <- order[1]
mbblfixture[58, "Away"] <- order[2]
mbblfixture[59, "Home"] <- order[3]
mbblfixture[57, "Home"] <- order[4]
mbblfixture[57, "Away"] <- order[5]

mbblfixture[57, "HomeRating"] <- table[match((mbblfixture[57, "Home"]),rownames(table)),"ratings"]
mbblfixture[57, "AwayRating"] <- table[match((mbblfixture[57, "Away"]),rownames(table)),"ratings"]
homewinchance <- (10^(mbblfixture[57, "HomeRating"]/400))/((10^(mbblfixture[57, "HomeRating"]/400))+(10^(mbblfixture[57, "AwayRating"]/400)))
result <- runif(1)
if (result < homewinchance){
  table[match(mbblfixture[57, "Home"],rownames(table)),"ratings"] <- table[match(mbblfixture[57, "Home"],rownames(table)),"ratings"] + 20 * (1 - homewinchance)
  table[match(mbblfixture[57, "Away"],rownames(table)),"ratings"] <- table[match(mbblfixture[57, "Away"],rownames(table)),"ratings"] - 20 * (1 - homewinchance)
  mbblfixture[59, "Away"] <- mbblfixture[57, "Home"]
} else {
  table[match(mbblfixture[57, "Away"],rownames(table)),"ratings"] <- table[match(mbblfixture[57, "Away"],rownames(table)),"ratings"] + 20 * (homewinchance)
  table[match(mbblfixture[57, "Home"],rownames(table)),"ratings"] <- table[match(mbblfixture[57, "Home"],rownames(table)),"ratings"] - 20 * (homewinchance)
  mbblfixture[59, "Away"] <- mbblfixture[57, "Away"]
}

mbblfixture[58, "HomeRating"] <- table[match((mbblfixture[58, "Home"]),rownames(table)),"ratings"]
mbblfixture[58, "AwayRating"] <- table[match((mbblfixture[58, "Away"]),rownames(table)),"ratings"]
homewinchance <- (10^(mbblfixture[58, "HomeRating"]/400))/((10^(mbblfixture[58, "HomeRating"]/400))+(10^(mbblfixture[58, "AwayRating"]/400)))
result <- runif(1)
if (result < homewinchance){
  table[match(mbblfixture[58, "Home"],rownames(table)),"ratings"] <- table[match(mbblfixture[58, "Home"],rownames(table)),"ratings"] + 20 * (1 - homewinchance)
  table[match(mbblfixture[58, "Away"],rownames(table)),"ratings"] <- table[match(mbblfixture[58, "Away"],rownames(table)),"ratings"] - 20 * (1 - homewinchance)
  mbblfixture[61, "Home"] <- mbblfixture[58, "Home"]
  finishes[match(mbblfixture[61, "Home"],rownames(finishes)),"GF"] <- finishes[match(mbblfixture[61, "Home"],rownames(finishes)),"GF"] + 1
  mbblfixture[60, "Home"] <- mbblfixture[58, "Away"]
} else {
  table[match(mbblfixture[58, "Away"],rownames(table)),"ratings"] <- table[match(mbblfixture[58, "Away"],rownames(table)),"ratings"] + 20 * (homewinchance)
  table[match(mbblfixture[58, "Home"],rownames(table)),"ratings"] <- table[match(mbblfixture[58, "Home"],rownames(table)),"ratings"] - 20 * (homewinchance)
  mbblfixture[61, "Home"] <- mbblfixture[58, "Away"]
  finishes[match(mbblfixture[61, "Home"],rownames(finishes)),"GF"] <- finishes[match(mbblfixture[61, "Home"],rownames(finishes)),"GF"] + 1
  mbblfixture[60, "Home"] <- mbblfixture[58, "Home"]
}

mbblfixture[59, "HomeRating"] <- table[match((mbblfixture[59, "Home"]),rownames(table)),"ratings"]
mbblfixture[59, "AwayRating"] <- table[match((mbblfixture[59, "Away"]),rownames(table)),"ratings"]
homewinchance <- (10^(mbblfixture[59, "HomeRating"]/400))/((10^(mbblfixture[59, "HomeRating"]/400))+(10^(mbblfixture[59, "AwayRating"]/400)))
result <- runif(1)
if (result < homewinchance){
  table[match(mbblfixture[59, "Home"],rownames(table)),"ratings"] <- table[match(mbblfixture[59, "Home"],rownames(table)),"ratings"] + 20 * (1 - homewinchance)
  table[match(mbblfixture[59, "Away"],rownames(table)),"ratings"] <- table[match(mbblfixture[59, "Away"],rownames(table)),"ratings"] - 20 * (1 - homewinchance)
  mbblfixture[60, "Away"] <- mbblfixture[59, "Home"]
} else {
  table[match(mbblfixture[59, "Away"],rownames(table)),"ratings"] <- table[match(mbblfixture[59, "Away"],rownames(table)),"ratings"] + 20 * (homewinchance)
  table[match(mbblfixture[59, "Home"],rownames(table)),"ratings"] <- table[match(mbblfixture[59, "Home"],rownames(table)),"ratings"] - 20 * (homewinchance)
  mbblfixture[60, "Away"] <- mbblfixture[59, "Away"]
}

mbblfixture[60, "HomeRating"] <- table[match((mbblfixture[60, "Home"]),rownames(table)),"ratings"]
mbblfixture[60, "AwayRating"] <- table[match((mbblfixture[60, "Away"]),rownames(table)),"ratings"]
homewinchance <- (10^(mbblfixture[60, "HomeRating"]/400))/((10^(mbblfixture[60, "HomeRating"]/400))+(10^(mbblfixture[60, "AwayRating"]/400)))
result <- runif(1)
if (result < homewinchance){
  table[match(mbblfixture[60, "Home"],rownames(table)),"ratings"] <- table[match(mbblfixture[60, "Home"],rownames(table)),"ratings"] + 20 * (1 - homewinchance)
  table[match(mbblfixture[60, "Away"],rownames(table)),"ratings"] <- table[match(mbblfixture[60, "Away"],rownames(table)),"ratings"] - 20 * (1 - homewinchance)
  mbblfixture[61, "Away"] <- mbblfixture[60, "Home"]
  finishes[match(mbblfixture[61, "Away"],rownames(finishes)),"GF"] <- finishes[match(mbblfixture[61, "Away"],rownames(finishes)),"GF"] + 1
} else {
  table[match(mbblfixture[60, "Away"],rownames(table)),"ratings"] <- table[match(mbblfixture[60, "Away"],rownames(table)),"ratings"] + 20 * (homewinchance)
  table[match(mbblfixture[60, "Home"],rownames(table)),"ratings"] <- table[match(mbblfixture[60, "Home"],rownames(table)),"ratings"] - 20 * (homewinchance)
  mbblfixture[61, "Away"] <- mbblfixture[60, "Away"]
  finishes[match(mbblfixture[61, "Away"],rownames(finishes)),"GF"] <- finishes[match(mbblfixture[61, "Away"],rownames(finishes)),"GF"] + 1
}

mbblfixture[61, "HomeRating"] <- table[match((mbblfixture[61, "Home"]),rownames(table)),"ratings"]
mbblfixture[61, "AwayRating"] <- table[match((mbblfixture[61, "Away"]),rownames(table)),"ratings"]
homewinchance <- (10^(mbblfixture[61, "HomeRating"]/400))/((10^(mbblfixture[61, "HomeRating"]/400))+(10^(mbblfixture[61, "AwayRating"]/400)))
result <- runif(1)
if (result < homewinchance){
  table[match(mbblfixture[61, "Home"],rownames(table)),"ratings"] <- table[match(mbblfixture[61, "Home"],rownames(table)),"ratings"] + 20 * (1 - homewinchance)
  table[match(mbblfixture[61, "Away"],rownames(table)),"ratings"] <- table[match(mbblfixture[61, "Away"],rownames(table)),"ratings"] - 20 * (1 - homewinchance)
  finishes[match(mbblfixture[61, "Home"],rownames(finishes)),"Win"] <- finishes[match(mbblfixture[61, "Home"],rownames(finishes)),"Win"] + 1
} else {
  table[match(mbblfixture[61, "Away"],rownames(table)),"ratings"] <- table[match(mbblfixture[61, "Away"],rownames(table)),"ratings"] + 20 * (1 - homewinchance)
  table[match(mbblfixture[61, "Home"],rownames(table)),"ratings"] <- table[match(mbblfixture[61, "Home"],rownames(table)),"ratings"] - 20 * (1 - homewinchance)
  finishes[match(mbblfixture[61, "Away"],rownames(finishes)),"Win"] <- finishes[match(mbblfixture[61, "Away"],rownames(finishes)),"Win"] + 1
}

for (i in teams){
  finishes[i, which(rownames(table) == i)] <- finishes[i, which(rownames(table) == i)] + 1
}

}