local Morphs = game.ServerStorage:WaitForChild("Morphs")
local GroupId = 15469577

local function MorphPlayer(plr, Model)
	local NewModel = Model:Clone()
	local CurrentPlayer = plr.Character
	
	if not CurrentPlayer:FindFirstChild("Other") then
		local Other = Instance.new("Folder", CurrentPlayer)
		Other.Name = "Others"
	end
	
	CurrentPlayer.Others:ClearAllChildren()
	
	--[[for i, v in pairs(CurrentPlayer:GetDescendants()) do
		if v:IsA("Accessory") or v:IsA("Clothing") then
			v:Destroy()
		end
	end--]]
	
	--CurrentPlayer:WaitForChild("Torso").Transparency = 1
	--CurrentPlayer:WaitForChild("Right Leg").Transparency = 1
	--CurrentPlayer:WaitForChild("Right Arm").Transparency = 1
	--CurrentPlayer:WaitForChild("Left Leg").Transparency = 1
	--CurrentPlayer:WaitForChild("Left Arm").Transparency = 1
    --CurrentPlayer:WaitForChild("Head").Transparency = 1
	
	for i, v in pairs(NewModel.Other:GetChildren()) do
		if v:IsA("BasePart") then
			local WeldInside = v:FindFirstChildOfClass("Weld")
			if WeldInside then
				local NewAddon = v:Clone()
				NewAddon.Weld.Part0 = NewAddon
				NewAddon.Weld.Part1 = CurrentPlayer:FindFirstChild(WeldInside.Part1.Name)
				NewAddon.Parent = CurrentPlayer.Others
			end
		end
	end
	
	for i, v in pairs(NewModel:GetChildren()) do
		if v:IsA("BasePart") then
			if v.Name ~= "Head" then
				local NewPart = v:Clone()
				NewPart.Position = CurrentPlayer[NewPart.Name].Position
				local NewWeld = Instance.new("Weld", NewPart)
				NewWeld.Part0 = NewPart
				NewWeld.Part1 = CurrentPlayer[NewPart.Name]
				NewPart.Parent = CurrentPlayer.Others
			end
 		end
	end
end

local function AddMorph(plr)
	if plr:IsInGroup(GroupId) then
		local PlayerRank = plr:GetRankInGroup(GroupId)
		local Morph = Morphs[GroupId][PlayerRank]

		local MorphModel

		for i, v in pairs(Morph:GetChildren()) do
			MorphModel = v
			break
		end

		if Morph then
			wait(game.Players.RespawnTime + 1)
			MorphPlayer(plr, MorphModel)
		end
	end
end

game.Players.PlayerAdded:Connect(function(plr)
	AddMorph(plr)
	
	plr.Character:WaitForChild("Humanoid").Died:Connect(function()
		AddMorph(plr)
	end)
end)