local ent = null;

local cash = 100;
local loss = 50;

ShowMessage("Loading ForceEnableUpgrades VScript...");
ForceEnableUpgrades(2);

while( ent = Entities.FindByClassname(ent, "func_upgradestation")  )
{
    ent.Destroy();
}

while( ent = Entities.FindByClassname(ent, "func_regenerate") )
{
   printl("Located: " + ent + " @ " + ent.GetCenter());
   local upgradeStation = SpawnEntityFromTable("func_upgradestation", {
        origin       = ent.GetCenter(),
        angles       = ent.GetAbsAngles(),
        model = "*21"
    })
   printl("Created: " + upgradeStation + " @ " + upgradeStation.GetCenter());
}

function OnGameEvent_player_death(params)
{
    local player = GetPlayerFromUserID(params.attacker)
    local victim = GetPlayerFromUserID(params.userid)
    local assister = null

    if ( player != victim ) {
        player.AddCurrency(cash)

        if ( params.assister >= 0 ) {
            assister = GetPlayerFromUserID(params.assister)
            if ( assister ) {
                assister.AddCurrency( floor(cash/2) )
            }
        }

        if ( (victim.GetCurrency() - loss) > 0 ) {
            victim.RemoveCurrency( loss )
        } else {
            victim.SetCurrency(0)
        }
    }
}

__CollectGameEventCallbacks(this)