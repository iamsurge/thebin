modem = peripheral.wrap("left")
modem.open(10)
CanChangeRoof = true
RoofOpen = not turtle.detect()

function PlaceStrip()
    turtle.forward()
    turtle.placeDown()
    turtle.forward()
    turtle.placeDown()
    turtle.forward()
    turtle.placeDown() 
    turtle.forward()
    turtle.placeDown() 
    turtle.forward()
    turtle.placeDown() 
    turtle.forward()
    turtle.placeDown() 
    turtle.forward()
    turtle.placeDown() 
end
function RemoveStrip()
    turtle.forward()
    turtle.digDown()
    turtle.forward()
    turtle.digDown()
    turtle.forward()
    turtle.digDown() 
    turtle.forward()
    turtle.digDown() 
    turtle.forward()
    turtle.digDown() 
    turtle.forward()
    turtle.digDown() 
    turtle.forward()
    turtle.digDown() 
end
function ChangeRoof(Remove)
    turtle.select(1)
    if turtle.getFuelLevel() < 300 then
        turtle.turnLeft()
        turtle.turnLeft()
        turtle.select(10)
        turtle.place()
        turtle.suck()
        turtle.refuel()
        turtle.dig()
        turtle.select(1)
        turtle.turnLeft()
        turtle.turnLeft()
    end
    CanChangeRoof = false
    turtle.up()
    if Remove then RemoveStrip() else PlaceStrip() end
    turtle.forward()
    turtle.turnRight()
    turtle.forward()
    turtle.turnRight()
    if Remove then RemoveStrip() else PlaceStrip() end
    turtle.forward()
    turtle.turnLeft()
    turtle.forward()
    turtle.turnLeft()
    if Remove then RemoveStrip() else PlaceStrip() end
    turtle.forward()
    turtle.turnRight()
    turtle.forward()
    turtle.turnRight()
    if Remove then RemoveStrip() else PlaceStrip() end
    turtle.forward()
    turtle.turnLeft()
    turtle.forward()
    turtle.turnLeft()
    if Remove then RemoveStrip() else PlaceStrip() end
    turtle.forward()
    turtle.turnRight()
    turtle.forward()
    turtle.turnRight()
    if Remove then RemoveStrip() else PlaceStrip() end
    turtle.forward()
    turtle.turnLeft()
    turtle.forward()
    turtle.turnLeft()
    if Remove then RemoveStrip() else PlaceStrip() end
    turtle.forward()
    turtle.turnRight()
    turtle.forward()
	turtle.forward()
	turtle.forward()
	turtle.forward()
	turtle.forward()
	turtle.forward()
    turtle.turnRight()
    RoofOpen = Remove
    CanChangeRoof = true
end
while true do
    local event, modemSide, senderChannel,replyChannel, message, senderDistance = os.pullEvent("modem_message")
    if CanChangeRoof then
        if message == "OpenBigSilo" then
            print("Received Open Message")
            if not RoofOpen then
                ChangeRoof(true)
            end
        elseif message == "CloseBigSilo" then
            print("Received Close Message")
            if RoofOpen then
                ChangeRoof(false)
            end
        end
    end
    sleep(1)
end

    