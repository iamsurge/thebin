#!/bin/bash
# Special info script
info=("YOORCOMPANYNAME" 2022 "YOUREMAIL" "(c) All right reserved" "Information script")
label=("INFO" "NETWORK" "HARDWARE" "SOFTWARE" "PROCESS" "COPYRIGHT" "SECURITY" "WEATHER")
color=("\033[0;31m" "\033[0;32m" "\033[0;33m" "\033[0;35m" "\033[0;37m" "\033[0;34m" "\033[0;36m") 
#red-0 green-1 yellow-2 purple-3 white-4 blue-5 cyan-6

# ---------------------------------------------------------------------
function write_line() {
	printf -- '-%.0s' {1..100} && echo " "
}

function press_any_key() {
	read -s -n 1 -p "Press any key to continue ..." && echo ""
}

function press_q_key() {
	read -t 0.25 -N 1 input
        if [[ $input = "q" ]] || [[ $input = "Q" ]]; then
		echo
                break
	fi
}

clear
# Copyright Info
echo -e "[${color[2]}${label[5]}${color[4]}] ${color[2]}${info[0]} ${color[1]}${info[1]} ${color[4]}${info[3]} ${color[6]}${info[2]} ${color[2]}$(date) ${color[4]}"
# Get Weathet Info 
echo -e "[${color[2]}${label[7]}${color[4]}] 📍 Location: $(curl -s wttr.in/@$(curl -s -4 l2.io/ip)?format=3&lang=ru) 🌅 Full Condition: $(curl -s wttr.in/@$(curl -s -4 l2.io/ip)?format=2)"
	write_line
# General Info
echo -e "[${color[2]}${label[0]}${color[4]}]${color[1]} General info:${color[4]}"
echo -e "[${color[2]}${label[0]}${color[4]}] Uptime - ${color[1]}$(hostname): ${color[3]}$(uptime)${color[4]}"
	uname -a
	write_line
	lsb_release -a
echo -e ${color[2]}$(who)${color[4]}
echo -e "[${color[2]}${label[0]}${color[4]}] My current shell: $SHELL"
	if [ $(whoami) = "root" ]; then
		echo -e "${color[2]}${info[4]}:${color[0]} You are use root previlegion - be careful!${color[4]}"
	fi
	write_line
# Get Hardware Info
echo -e "[${color[2]}${label[2]}${color[4]}]${color[1]} Short info about system 🔒:${color[4]}"
	echo -e "$(sudo lshw -short)"
	write_line
	press_any_key
	write_line
# Get Network Info
echo -e "[${color[2]}${label[1]}${color[4]}]${color[1]} Network Interface info:${color[4]}"
	ip add show
	write_line
	press_any_key
# Get Memory Info
echo -e "[${color[2]}${label[3]}${color[4]}]${color[1]} Memory: \n${color[6]}$(free -c 1 -mlhs 1)${color[4]}"
        write_line
# Get Process Info
echo -e "[${color[2]}${label[4]}${color[4]}]${color[1]} Process sorted by memory:${color[4]}"
	ps -e -orss=,args= |awk '{print $1 " " $2 }'| awk '{tot[$2]+=$1;count[$2]++} END {for (i in tot) {print tot[i],i,count[i]}}' | sort -n | tail -n 15 | sort -nr | awk '{ hr=$1/1024; printf("%13.2fM", hr); print "\t" $2 }'
	write_line
# Get Disk Info
echo -e "[${color[2]}${label[2]}${color[4]}] ${color[1]}Disk Info:${color[4]}"
	df -h
	write_line
# Get Network Trafic Info
echo -e "[${color[2]}${label[1]}${color[4]}]${color[0]} Network trafic online ▶️ ${color[2]}(Press ${color[6]}q${color[2]} for stop ⏹️)${color[4]}"
	while true 
        	do OLD=$NEW
	        NEW=$(cat /proc/net/dev | grep ens18 | tr -s ' ' | cut -d' ' -f "3 11")
        	echo "$NEW" "$OLD" | awk '{printf("\rin (kB): % 9.2g\t\tout (kB): % 9.2g ", ($1-$3)/1024, ($2-$4)/1024)}'
	        sleep 0.5
			read -t 0.25 -N 1 input
			if [[ $input = "q" ]] || [[ $input = "Q" ]]; then
        			echo -e "${color[1]} Cancel execute 🗙...${color[4]}"
        			break
    			fi
	done
	write_line
# Get Logins and History info
echo -e "[${color[2]}${label[6]}${color[4]}] ${color[1]} Last Logins Info (${color[2]}last -i 10${color[1]}):${color[4]}"
	last -i -10
	write_line
echo -e "[${color[2]}${label[6]}${color[4]}]${color[1]} Last ${color[0]}Failure${color[1]} Logins Info (${color[2]}lastb${color[1]})🔒:${color[4]}"
	sudo lastb
	write_line
echo -e "[${color[2]}${label[6]}${color[4]}] ${color[1]} System Logins Info (${color[2]}getent passwd with awk${color[1]}):${color[4]}"
	cat /etc/passwd | grep -v nologin | awk -F: '{print $3, $1, "- " $5}' | sort -nk1 | awk '{print NR,$0}'
	write_line
echo -e "[${color[2]}${label[6]}${color[4]}] ${color[1]} Last History Commands (${color[2]}history 10${color[1]}):${color[4]}"
	echo " #!/bin/bash" >> hst.sh
	echo " history 10 | awk '{ print NR, \$0 }'" >> hst.sh
	chmod +x hst.sh; bash -i hst.sh
	rm hst.*
	write_line
echo -e "[${color[2]}${label[0]}${color[4]}] List interactive commands: ${color[2]}jobs, history, last...${color[4]}"
	press_any_key
