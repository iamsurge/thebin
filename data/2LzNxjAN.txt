local go = {}

local function checkFuel()
    local fuel = turtle.getFuelLevel()
    if fuel < 1 then
        print("Out of fuel.")
        while true do
            for i=1,16 do
                turtle.select(i)
                turtle.refuel()
            end
            if turtle.getFuelLevel() > 1 then
                print("Refueled.")
                break
            else
                print("Please put fuel in the turtles inventory and press a key.")
                os.pullEvent("key")
            end
        end
    end
end

local blacklist = {
    ["minecraft:stone"] = true,
    ["minecraft:cobblestone"] = true,
    ["minecraft:gravel"] = true,
}
local function dumpItems()
	for i=1,16 do
        local detail = turtle.getItemDetail(i)
        if detail and blacklist[detail.name] then
            turtle.select(i)
            turtle.dropDown()
        end
    end
    turtle.select(1)
end
function go.forward()
    checkFuel()
    while not turtle.forward() do
        turtle.dig()
    end
end
function go.back()
    checkFuel()
    while not turtle.back() do
    end
end

local function forward()
    turtle.dig()
    go.forward()
    turtle.digUp()
    turtle.digDown()
end

local function m3by3()
    forward()
    turtle.turnLeft()
    forward()
    go.back()
    turtle.turnRight()
    turtle.turnRight()
    forward()
    while not turtle.back() do end
    turtle.turnLeft()
end
dumpItems()
for t=1,30 do
    term.clear()
    term.setCursorPos(1,1)
    print("Fuel level: "..turtle.getFuelLevel())
    print("Progress:")
	print("["..string.rep("=",t-1)..string.rep(" ",30-t+1).."]")
    m3by3()
    dumpItems()
end
term.clear()
term.setCursorPos(1,1)
print("Fuel level: "..turtle.getFuelLevel())
print("Progress:")
print("["..string.rep("=",30).."]")
print("Done!")