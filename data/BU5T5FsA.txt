import csv
HEADER_LIST = ['author', 'album', 'year', 'genre', 'time']
LINE = '  ==============================  '


def get_header_index(searching_index):
    index_of_header = 0
    for header_index, header in enumerate(HEADER_LIST):
        if header == searching_index:
            index_of_header = header_index
    return int(index_of_header)


def import_data(filename='albums_data.txt'):
    with open(filename, newline='') as file:
        reader = csv.reader(file, delimiter=',')
        data = list(reader)
        return data


def export_data(albums, filename='albums_data.txt', mode='a'):
    if 'a' != mode != 'w':
        raise ValueError()

    with open(filename, mode, newline='') as file:
        writer = csv.writer(file)
        for album_index, album in enumerate(albums):
            writer.writerow(album)
    return file


def get_albums_by_genre(albums, genre):
    genre_index = get_header_index('genre')
    albums_by_genre = []
    for album in albums:
        if album[genre_index] == genre:
            albums_by_genre.append(album)
    return albums_by_genre


def get_genre_stats(albums):
    genre_index = get_header_index('genre')
    genres = set()

    for album in albums:
        genres.add(album[genre_index])

    out_dict = dict.fromkeys(genres, 0)

    for genre_id, genre in enumerate(genres):
        albums_in_this_genre = get_albums_by_genre(albums, genre)
        for nr_of_albums in albums_in_this_genre:
            out_dict[genre] += 1
    return out_dict


def get_last_oldest_of_genre(albums, genre):
    all_in_genre = get_albums_by_genre(albums, genre)
    year_index = get_header_index('year')
    year_nr = 0
    oldest_year = 3000
    for album_index, album in enumerate(all_in_genre):
        if int(album[year_index]) < oldest_year:
            oldest_year = int(album[year_index])
            year_nr = album_index
    return all_in_genre[year_nr]


if __name__ == '__main__':
    albums_data = import_data()
    print('\n' + LINE + 'IMPORT DATA ' + LINE)
    print(import_data())
    export_data('new_albums_data.txt', 'w')
    print('\n' + LINE + 'GET ALBUMS BY GENRE ' + LINE)
    print("ROCK:")
    print(get_albums_by_genre(albums_data, 'rock'))
    print('\n' + LINE + 'GET ALBUMS BY GENRE ' + LINE)
    print("POP:")
    print(get_albums_by_genre(albums_data, 'pop'))
    print('\n' + LINE + 'GET GENRE STATS' + LINE)
    print(get_genre_stats(albums_data))
    print('\n' + LINE + 'GET LAST OLDEST OF GENRE ' + LINE)
    print(get_last_oldest_of_genre(albums_data, 'pop'))
