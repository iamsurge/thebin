WITH comb_id AS (
         SELECT id FROM comb
         WHERE comb IN ('авш', 'ива')
         ),
         par_id AS (
         SELECT id FROM paragraph
         WHERE book IN (
             SELECT id FROM book WHERE genre = 'prose' AND lang = 'ru'
         )),
         comb_max AS (
         SELECT comb, MAX(count) cnt
         FROM par_inx
         WHERE comb IN (SELECT id FROM comb_id) AND paragraph IN (SELECT id FROM par_id) GROUP BY comb
         ),
         found AS (
             SELECT pi.paragraph,
                    SUM(pi.count / cm.cnt::float) score,
                    p.book, p.num, p.length
             FROM par_inx pi
             LEFT JOIN paragraph p ON pi.paragraph = p.id
             LEFT JOIN comb_max cm ON pi.comb = cm.comb
             WHERE p.length < 1000 AND paragraph IN (SELECT id FROM par_id) AND pi.comb IN (SELECT id FROM comb_id)
             GROUP BY paragraph, p.book, p.num, p.length
             ORDER BY score
         )
     SELECT * FROM found LIMIT 10;