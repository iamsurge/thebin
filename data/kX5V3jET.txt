@ECHO OFF
SETLOCAL ENABLEEXTENSIONS
COLOR 0A
TITLE RE-FORMAT A SPARE DRIVE

:----------------------------------------------------------------------------------------------

REM THIS WILL MAKE PERMANENT CHANGES TO YOUR HARD DRIVE BY ERASING 
REM AND REFORMATTING IT USING WINDOWS DISKPART.EXE SOFTWARE. MAKE SURE
REM YOU KNOW WHAT YOU WANT TO DO BEFORE USING THIS SCRIPT. I TAKE NO LIABILITY
REM FOR ANY LOST FILES.

:----------------------------------------------------------------------------------------------

REM OPEN CMD WINDOW MAXIMIZED
IF NOT "%1"=="MAX" START /MAX CMD /D /C %0 MAX & GOTO :EOF

:---------------------------------------------------------------------------------------------------------

REM DELETE ANY LEFTOVER FILES FROM PREVIOUS RUNS
IF EXIST "%TMP%\diskpart.txt" DEL /Q "%TMP%\diskpart.txt"

:---------------------------------------------------------------------------------------------------------

:START_OVER
REM CREATE FILE WITH DISK NUMBERED IN A LIST
ECHO >"%FNAME%" lis dis
CLS
REM ECHO THE NEWLY CREATED FILES CONTENTS INTO TERMINAL
"%WINDIR%\System32\diskpart.exe" /S "%TMP%\diskpart.txt"
REM PROMPT THE USER TO INPUT THE CORRECT DISC NUMBER
ECHO=
SET /P DISK="Enter the disk number: "
CLS
IF "%DISK%" NEQ "%DISK%" GOTO START_OVER

:---------------------------------------------------------------------------------------------------------

REM CREATES A TEMPORARY FILE THAT DISKPART CAN READ
SET /P "PTYPE=Please enter either GPT or MBR: "
ECHO=
SET /P "FSTYPE=Enter FS type (example: FAT32, NTFS, EXFAT): "
ECHO=
SET /P "LAB=Enter label: "
ECHO=
SET /P "LET=Enter Letter: "
CLS

:---------------------------------------------------------------------------------------------------------

ECHO Please review your choices: & ECHO=
ECHO Partition    = %PTYPE%
ECHO File System  = %FSTYPE%
ECHO Drive Label  = %LAB%
ECHO Drive Letter = %LET% & ECHO=
SET /P "DUMMY=Press enter to make changes to the drive as listed above: "
CLS

:---------------------------------------------------------------------------------------------------------

(
ECHO SELECT DISK %DISK%
ECHO CLEAN
ECHO CONVERT %PTYPE%
ECHO CREATE PARTITION PRIMARY
ECHO FORMAT FS="%FSTYPE%" LABEL="%LAB%" QUICK
ECHO ASSIGN LETTER=%LET%
ECHO EXIT
)>"%TMP%\diskpart.txt"

:---------------------------------------------------------------------------------------------------------

REM EXECUTE DISKPART TO MAKE THE CHANGES TO THE DISK
"%WINDIR%\System32\diskpart.exe" /S "%TMP%\diskpart.txt"

:---------------------------------------------------------------------------------------------------------

REM OPEN WITH NOTEPAD (UNCOMMENT THE BELOW COMMAND TO OPEN THE DISKPART FILE)
REM START "" /MAX "%WINDIR%\notepad.exe" "%TMP%\diskpart.txt"