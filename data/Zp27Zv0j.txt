rednet.open(peripheral.getName(peripheral.find('modem')))

local images = {}

local handle = io.open('video.cctvv','rb')
local width,height,dat
local image = {}
local line  = {}
local k = 1
for c in handle:read('a'):gmatch('[^,]+') do
    if k == 1 then width = tonumber(c) end
    if k == 2 then height = tonumber(c) end
    if k == 3 then dat = c end
    k = k +1
end
local k = 1
for c in dat:gmatch('.') do
    table.insert(line,2^c:byte())
    if k%width == width-1 then
        table.insert(image,line)
        line = {}
    end
    if k%(width*height) == width*height-1 then
        table.insert(images,image)
        image = {}
    end
    k = k +1
end
handle:close()

io.write('frequency: ')
local channelid = io.read()
local channel = 'cctv:'..channelid

local n = 0

while true do

    n = n +1
    
    rednet.broadcast(images[(n%#images)+1],channel)

    sleep(0)

end