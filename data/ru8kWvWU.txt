from kivy.app import App
from kivy.lang import Builder
from kivy.event import EventDispatcher
from kivy.network.urlrequest import UrlRequest
from kivy.properties import StringProperty

kv = """
BoxLayout:
    orientation: 'vertical'
    Label:
        id: label
        text_size: self.size
        valign: 'center'
        halign: 'center'
        padding: 10,10
        font_size: 40
        text: app.aw.cat_fact
    Button:
        size_hint_y: None
        height: 48
        text: 'Get Cat Fact'
        on_release: app.aw.get_cat_fact()
"""


class AccessWeb(EventDispatcher):
    cat_fact = StringProperty()

    def get_cat_fact(self):
        UrlRequest('https://catfact.ninja/fact?max_length=140',
                   on_success=self.net_success, on_failure=self.net_fail)

    def net_success(self,req, r):
        print(f'Success: {req.is_finished}')
        print(r)
        self.cat_fact = r['fact']

    def net_fail(self, req, r):
        print("Fail:", r)


class TestAccessWebApp(App):
    def __init__(self, **kwargs):
        super().__init__(**kwargs)
        self.aw = AccessWeb()

    def build(self):
        return Builder.load_string(kv)


TestAccessWebApp().run()
