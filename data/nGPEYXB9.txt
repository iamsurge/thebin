(read-enable 'case-insensitive)

(DEFINE-SYNTAX IMPORT-FROM (SYNTAX-RULES ()
  ((_ ((PARTIAL ...) ((COMPLETION ...) SYMBOLS ...)))
    (IMPORT (ONLY (PARTIAL ... COMPLETION ...) SYMBOLS ...)))
  ((_ (PARTIAL COMPLETION REST ...)) (BEGIN
    (IMPORT-FROM (PARTIAL COMPLETION))
    (IMPORT-FROM (PARTIAL REST ...))))
  ((_ LIBRARY REST ...) (BEGIN
    (IMPORT-FROM LIBRARY)
    (IMPORT-FROM REST ...)))))



(IMPORT-FROM

((GUIX GEXP)
  (()               LOCAL-FILE
                    PLAIN-FILE))
((GNU SYSTEM)
  ((UUID)           UUID)
  ((KEYBOARD)       KEYBOARD-LAYOUT)
  ((FILE-SYSTEMS)   %BASE-FILE-SYSTEMS
                    FILE-SYSTEM
                    SWAP-SPACE))
((GNU BOOTLOADER)
  (()               BOOTLOADER-CONFIGURATION)
  ((GRUB)           GRUB-EFI-BOOTLOADER))
((GNU SERVICES)
  ((BASE)           %DEFAULT-SUBSTITUTE-URLS
                    %DEFAULT-AUTHORIZED-GUIX-KEYS
                    GUIX-CONFIGURATION
                    GUIX-SERVICE-TYPE)
  ((XORG)           XORG-CONFIGURATION
                    SET-XORG-CONFIGURATION)
  ((DESKTOP)        %DESKTOP-SERVICES
                    BLUETOOTH-SERVICE
                    GNOME-DESKTOP-SERVICE-TYPE
                    XFCE-DESKTOP-SERVICE-TYPE)
  ((SOUND)          LADSPA-SERVICE-TYPE
                    LADSPA-CONFIGURATION
                    PULSEAUDIO-SERVICE-TYPE)
  ((VIRTUALIZATION) LIBVIRT-SERVICE-TYPE
                    VIRTLOG-SERVICE-TYPE))
((GNU PACKAGES)
  ((AUDIO)          SWH-PLUGINS)
  ((CERTS)          NSS-CERTS)
  ((WM)             I3-GAPS
                    I3STATUS)
  ((SUCKLESS)       DMENU))
((NONGNU PACKAGES)
  ((LINUX)          LINUX
                    LINUX-FIRMWARE))

)



(DEFINE KEYBOARD-LAYOUT (KEYBOARD-LAYOUT "us" #:OPTIONS (LIST
  "compose:ralt"))) ; RIGHT ALT FOR CHARACTERS NOT ON KEYBOARD.
                    ; TAP IN SEQUENCE, ALT, A, E, GIVES Ã†.

(OPERATING-SYSTEM
  (BOOTLOADER (BOOTLOADER-CONFIGURATION
    (BOOTLOADER GRUB-EFI-BOOTLOADER)
    (TARGETS (LIST "/UEFI"))
    (KEYBOARD-LAYOUT KEYBOARD-LAYOUT)))

  (KERNEL LINUX)
  (FIRMWARE (LIST LINUX-FIRMWARE))

  (HOST-NAME "1920")

  (TIMEZONE "America/New_York")
  (LOCALE "en_US.utf8")
  (KEYBOARD-LAYOUT KEYBOARD-LAYOUT)

  (SERVICES (MODIFY-SERVICES
    (APPEND %DESKTOP-SERVICES (LIST
      (BLUETOOTH-SERVICE #:AUTO-ENABLE? #T)
      (SERVICE GNOME-DESKTOP-SERVICE-TYPE)
      (SERVICE LIBVIRT-SERVICE-TYPE)
      (SERVICE VIRTLOG-SERVICE-TYPE)
      (SERVICE XFCE-DESKTOP-SERVICE-TYPE)
      (SERVICE LADSPA-SERVICE-TYPE (LADSPA-CONFIGURATION
        (PLUGINS (LIST
          SWH-PLUGINS))))
      (SET-XORG-CONFIGURATION (XORG-CONFIGURATION
        (KEYBOARD-LAYOUT KEYBOARD-LAYOUT)))))
    (GUIX-SERVICE-TYPE CONFIG => (GUIX-CONFIGURATION
      (INHERIT CONFIG)
      (SUBSTITUTE-URLS (APPEND %DEFAULT-SUBSTITUTE-URLS (LIST
        "HTTPS://SUBSTITUTES.NONGUIX.ORG")))
      (AUTHORIZED-KEYS (APPEND %DEFAULT-AUTHORIZED-GUIX-KEYS (LIST
        (LOCAL-FILE "KEYS/NONGUIX"))))))))

  (PACKAGES (APPEND %BASE-PACKAGES (LIST
    DMENU
    I3-GAPS
    I3STATUS
    NSS-CERTS)))

  (USERS (APPEND %BASE-USER-ACCOUNTS (LIST
    (USER-ACCOUNT
      (NAME "MASON1920")
      (GROUP "users") ; MAN, UNMACHINE.
      (HOME-DIRECTORY "/MASON1920")
      (SUPPLEMENTARY-GROUPS (LIST
        "audio" ; PLAY SOUND
        "kvm" ; HARDWARE ACCELERATED VIRTUALIZATION
        "libvirt"
        "lp" ; PRINTER
        "netdev" ; NETWORK INTERFACE MANAGEMENT
        "video" ; VIDEO INPUT (WEBCAM)
        "wheel")))))) ; SUDO

  (FILE-SYSTEMS (APPEND %BASE-FILE-SYSTEMS (LIST
    (FILE-SYSTEM
      (MOUNT-POINT "/")
      (NEEDED-FOR-BOOT? #T)
      (DEVICE (UUID "9FB64C3D-4E54-4F9A-A5EE-7E333D52522C"))
      (TYPE "ext4"))
    (FILE-SYSTEM
      (MOUNT-POINT "/UEFI")
      (DEVICE (UUID "90E9-220F" 'FAT32))
      (TYPE "vfat")))))

  (SWAP-DEVICES (LIST
    (SWAP-SPACE (TARGET (UUID "4C7B0129-03AF-4D50-B77B-4B1AA82A6ADA"))))))
