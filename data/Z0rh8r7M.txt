local DSS = game:GetService("DataStoreService")
local Bank = DSS:GetDataStore("Kasa")
local Spis = DSS:GetDataStore("Pokonani")


game.Players.PlayerAdded:Connect(function(gracz)
	
	local kasa = Bank:GetAsync(gracz.UserId) or 0
	local pokonani = Spis:GetAsync(gracz.UserId) or 0
		
	local tablicaNaSerwerze = Instance.new("Folder", game.ServerStorage)
	tablicaNaSerwerze.Name = gracz.Name
	
	local kasaNaSerwerze = Instance.new("NumberValue", tablicaNaSerwerze)
	kasaNaSerwerze.Name = "Kasa"
	kasaNaSerwerze.Value = kasa
	
	local pokonaniNaSerwerze = Instance.new("NumberValue", tablicaNaSerwerze)
	pokonaniNaSerwerze.Name = "Pokonani"
	pokonaniNaSerwerze.Value = pokonani

	local tablicaLokalnie = Instance.new("Folder", gracz)
	tablicaLokalnie.Name = "leaderstats"
	
	local kasaLokalnie = Instance.new("NumberValue", tablicaLokalnie)
	kasaLokalnie.Name = "Kasa"
	kasaLokalnie.Value = kasa
	
	local pokonaniLokalnie = Instance.new("NumberValue", tablicaLokalnie)
	pokonaniLokalnie.Name = "Pokonani"
	pokonaniLokalnie.Value = pokonani
	
	gracz:LoadCharacter()
	
	kasaNaSerwerze.Changed:connect(function(liczba)
		kasaLokalnie.Value = liczba
	end)
	
	pokonaniNaSerwerze.Changed:connect(function(liczba)
		pokonaniLokalnie.Value = liczba
	end)
	
	game.Players.PlayerRemoving:Connect(function(gracz)
		Bank:SetAsync(gracz.UserId, kasaNaSerwerze.Value)
		Spis:SetAsync(gracz.UserId, pokonaniNaSerwerze.Value)
		if tablicaNaSerwerze.Name == gracz.Name then
			tablicaNaSerwerze:Destroy()
		end
	end)
	

	while true do
		Bank:SetAsync(gracz.UserId, kasaNaSerwerze.Value)
		Spis:SetAsync(gracz.UserId, pokonaniNaSerwerze.Value)
		print("Kasa zapisana!")
		
		wait(10)
	end
	
end)