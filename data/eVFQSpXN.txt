import entities.Employee;

import javax.persistence.EntityManager;
import javax.persistence.EntityManagerFactory;
import javax.persistence.Persistence;
import java.util.List;


public class IncreaseSalaries {
    private static final String DATABASE_NAME = "soft_uni";
    private static final String PARAM1 = "Engineering";
    private static final String PARAM2 = "Tool Design";
    private static final String PARAM3 = "Marketing";

    public static void main(String[] args) {
        EntityManagerFactory emf = Persistence.createEntityManagerFactory(DATABASE_NAME);
        EntityManager em = emf.createEntityManager();
        em.getTransaction().begin();

        List<Employee> resultList2 = getEmployees(em);
        if(resultList2.size()>0){
            for (Employee employee : resultList2) {
                em.createQuery("UPDATE Employee set salary = salary * 0.12 + salary where id = :n").setParameter("n", employee.getId()).executeUpdate();
            }
            em.getTransaction().commit();
        }
        em.clear(); // зачиствам контекста
        
        List<Employee> resultList3 = getEmployees(em);
        
        resultList3.forEach(e-> System.out.printf("%s %s ($%.2f)\n",e.getFirstName(),e.getLastName(),e.getSalary()));
        em.close();
    }
    public static List<Employee>  getEmployees(EntityManager em){
        return em.createQuery("SELECT e from Employee e where e.department.name in (:p1,:p2,:p3) ", Employee.class)
                .setParameter("p1", PARAM1)
                .setParameter("p2", PARAM2)
                .setParameter("p3", PARAM3).getResultList();

    }
}
