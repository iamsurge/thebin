#! /bin/bash
# $PROG: socks5proxy-finder
# Dependencies: jq, curl
# It may take a long time, be patient. Sit down and grab a cup of coffee. :)

proxylist="https://raw.githubusercontent.com/ShiftyTR/Proxy-List/master/socks5.txt"
check="https://ipwho.is/"

OIFS=$IFS
IFS='
'
while read -r proxy ; do
        ip="${proxy//:*}"
        port="${proxy//*:}"
        if ! ping -c3 "$ip" &> /dev/null ; then
                continue
        fi
        # cheange '--expect100-timeout <seconds>' arg below if you wish.
        proxyinfo=$(curl --expect100-timeout 5 --socks5 "$proxy" -s "$check" | \
                    jq '.country,.region')
        if [ -n "$proxyinfo" ] 
                then
                        echo -e "This anonymous socks5 proxy is working.\n"
                        echo -e "$ip\nPort: $port"
                        echo -e "$proxyinfo"
                        echo "##################################"
        fi
        sleep 1
done <<<$(curl -s "$proxylist")

unset IFS
IFS=$OIFS

exit 0