import 'package:flutter/material.dart';

void main() {
  runApp(
    MaterialApp(
      home: Row(
        children: [
          CursoScroller(
            cardsCursoState: List.generate(
                15,
                (_) => {
                      'depcod': 'FEN04-02675',
                      'name': 'Eletricidade II',
                      'state': 'sim',
                      'selected': false,
                      'turmas': [
                        {'state': 'sim', 'professor': 'antonio'},
                        {'state': 'nao', 'professor': 'marcos'},
                        {'state': 'sim', 'professor': 'andre'},
                      ]
                    }),
          ),
          Expanded(
            child: Container(
              color: Colors.green,
            ),
          )
        ],
      ),
    ),
  );
}

class CardCurso extends StatelessWidget {
  final Function selectSelf;
  final Function unSelectSelf;
  final String depcod;
  final String name;
  final String state;
  final bool selected;
  const CardCurso({
    super.key,
    required this.depcod,
    required this.name,
    required this.state,
    required this.unSelectSelf,
    required this.selectSelf,
    required this.selected,
  });

  static const Map<String, Color> possibleStates = {
    'nao': Colors.black,
    'sim': Colors.green,
    'talvez': Colors.amber,
  };

  @override
  Widget build(BuildContext context) {
    debugPrint('selected: $selected');
    return Card(
      color: Colors.white,
      elevation: 9,
      shape: RoundedRectangleBorder(borderRadius: BorderRadius.circular(9)),
      child: InkWell(
        splashColor: Colors.blue.withAlpha(30),
        onTap: selected ? () => unSelectSelf() : () => selectSelf(),
        child: SizedBox(
          height: 90,
          width: 220,
          child: Padding(
            padding: const EdgeInsets.all(8),
            child: Row(
              mainAxisAlignment: MainAxisAlignment.spaceBetween,
              children: [
                Column(
                  // mainAxisAlignment: MainAxisAlignment.spaceAround,
                  children: [
                    Text(depcod),
                    const SizedBox(height: 15),
                    Text(name),
                  ],
                ),
                Column(
                  children: [
                    Container(
                      height: 20,
                      width: 20,
                      color: possibleStates[state],
                    ),
                  ],
                )
              ],
            ),
          ),
        ),
      ),
    );
  }
}

class TurmaCard extends StatelessWidget {
  final String professor;
  final String state;
  final String turma;
  const TurmaCard({
    super.key,
    required this.professor,
    required this.state,
    required this.turma,
  });

  static const Map<String, Color> possibleStates = {
    'nao': Colors.black,
    'sim': Colors.green,
    'talvez': Colors.amber,
  };

  @override
  Widget build(BuildContext context) {
    return Card(
      color: Colors.white,
      elevation: 9,
      shape: RoundedRectangleBorder(borderRadius: BorderRadius.circular(9)),
      child: InkWell(
        splashColor: Colors.blue.withAlpha(30),
        onTap: () {
          Null;
        },
        child: SizedBox(
          height: 90,
          width: 220,
          child: Padding(
            padding: const EdgeInsets.all(8),
            child: Row(
              mainAxisAlignment: MainAxisAlignment.spaceBetween,
              children: [
                Column(children: [
                  Text(turma),
                  const SizedBox(height: 15),
                  Text(professor),
                ]),
                Column(
                  children: [
                    Container(
                      height: 20,
                      width: 20,
                      color: possibleStates[state],
                    )
                  ],
                ),
              ],
            ),
          ),
        ),
      ),
    );
  }
}

class CursoScroller extends StatefulWidget {
  final List<Map> cardsCursoState;
  const CursoScroller({super.key, required this.cardsCursoState});
  @override
  State<CursoScroller> createState() => _CursoScrollerState();
}

class _CursoScrollerState extends State<CursoScroller> {
  bool isCursoSelected = false;
  late List<Map> cardsCursoState;
  List<Map> selectedCursoClassCardsStates = [];

  void unSelectSelf(int index) {
    setState(() {
      debugPrint('unselectSelf');
      isCursoSelected = false;
      cardsCursoState[index]['selected'] = false;
      selectedCursoClassCardsStates.clear();
    });
  }

  Function makeUnSelectSelf(int index) {
    return () => unSelectSelf(index);
  }

  void selectSelf(int index) {
    setState(() {
      debugPrint('selectSelf');
      isCursoSelected = true;
      cardsCursoState[index]['selected'] = true;
      selectedCursoClassCardsStates.add(cardsCursoState[index]);
      selectedCursoClassCardsStates.addAll(cardsCursoState[index]['turmas']);
    });
  }

  Function makeSelectSelf(int index) {
    return () => selectSelf(index);
  }

  @override
  Widget build(BuildContext context) {
    cardsCursoState = widget.cardsCursoState;
    return Container(
      width: 220,
      height: double.infinity,
      color: Colors.blue,
      child: ListView.builder(
        shrinkWrap: true,
        itemCount: isCursoSelected ? selectedCursoClassCardsStates.length : cardsCursoState.length,
        itemBuilder: isCursoSelected
            ? (BuildContext context, int index) {
                if (index == 0) {
                  return CardCurso(
                    depcod: selectedCursoClassCardsStates[index]['depcod'],
                    name: selectedCursoClassCardsStates[index]['name'],
                    state: selectedCursoClassCardsStates[index]['state'],
                    selected: selectedCursoClassCardsStates[index]['selected'],
                    selectSelf: makeSelectSelf(index),
                    unSelectSelf: makeUnSelectSelf(index),
                  );
                } else {
                  return TurmaCard(
                      professor: selectedCursoClassCardsStates[index]['professor'],
                      state: selectedCursoClassCardsStates[index]['state'],
                      turma: '$index');
                }
              }
            : (BuildContext context, int index) {
                return CardCurso(
                  depcod: cardsCursoState[index]['depcod'],
                  name: cardsCursoState[index]['name'],
                  state: cardsCursoState[index]['state'],
                  selected: cardsCursoState[index]['selected'],
                  selectSelf: makeSelectSelf(index),
                  unSelectSelf: makeUnSelectSelf(index),
                );
              },
      ),
    );
  }
}
