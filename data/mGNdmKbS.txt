install.packages("pscl")
install.packages("randomForest")
install.packages("doParallel")
library(pscl)
library(randomForest)
library(doParallel) 

detectCores() # Проверяем, сколько ядер можем использовать

system.time({iris_rf <- randomForest(Species~.,data=iris,ntree=500,proximity=TRUE)})
varImpPlot(iris_rf)
importance(iris_rf)
iris_rf

# Функция принимает на вход число ядер и возвращает время
calc_time <- function(c){
  registerDoParallel(cores = c)
  t <- system.time({iris_rf2 <- foreach(ntree=rep(100,5), .combine=combine, .packages=c('randomForest',"pscl")) %dopar% randomForest(Species~.,data=iris,ntree=ntree,proximity=TRUE)})
  print(t)
  return(t[3])
}

t1 <- sapply(1:5, calc_time)
x1 <- c(1:5)

plot(x1, t1, type="o", xlab = "Число ядер", ylab= "Время")
