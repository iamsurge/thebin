    .global partition
    .text
partition:
    push    %eax
    push    %ebx

    movl    %ebx,   %eax

    addl    %esi,   %eax
    addl    %esi,   %eax
    #   ebx - начало массива
    #   eax - конец массива

loop:
    cmp     %ebx,   %eax
    jg      endloop
forward:
    cmp     (%ebx, 2),  %edi
    jge     endforward
    addl    $2,     %ebx
    jmp     forward
endforward:
backward:
    cmp     (%eax, 2),  %edi
    jle     endbackward
    subl    $2,     %ebx
    jmp     backward   
endbackward:
    cmp     %ebx,   %eax
    jge      endloop
    xor     (%ebx, 2),  *(%eax, 2)
    xor     (%eax, 2),  *(%ebx, 2)
    xor     (%ebx, 2),  *(%eax, 2)
    addl    $2,     %ebx
    subl    $2,     %eax
    jmp loop
endloop:
    movl    %eax,   %edx # но еще не сдвинуто...
    pop     %ebx
    pop     %eax
    subl    %edx,   %ebx # вычтем начало
    shr     $1,     %edx # и поделим на 2