CREATE DATABASE IF NOT EXISTS comedores_db
CHARACTER SET 'utf8mb4';

USE comedores_db;

CREATE TABLE estados_necesidad(
	id int not null auto_increment,
    descripcion varchar(50) not null,
    PRIMARY KEY (id)
);
CREATE TABLE estados_reporte(
	id int not null auto_increment,
    descripcion varchar(50) not null,
    PRIMARY KEY (id)
);
CREATE TABLE tipos_necesidad(
	id int not null auto_increment,
    descripcion varchar(50) not null,
    PRIMARY KEY (id)
);
CREATE TABLE tipos_reporte(
	id int not null auto_increment,
    descripcion varchar(50) not null,
    PRIMARY KEY (id)
);
CREATE TABLE tipos_usuario(
	id int not null auto_increment,
    descripcion varchar(50) not null,
    PRIMARY KEY (id)
);
CREATE TABLE usuarios(
	id bigint not null auto_increment,
    email varchar(50) not null unique,
    password varchar(50) not null,
    tipo_id int not null,
    nombre varchar(50) not null,
    apellido varchar(50) not null,
    dni varchar(10) not null unique,
    direccion varchar(50) null,
    localidad varchar(50) null,
    provincia varchar(50) null,
    telefono varchar(20) null,
    estado bit not null default true,
    PRIMARY KEY (id),
    FOREIGN KEY (tipo_id) REFERENCES  tipos_usuario(id)
);
CREATE TABLE reportes(
	id bigint not null auto_increment,
    tipo_id int not null,
    estado_id int not null,
    fecha_alta date not null,
    descripcion varchar(200) not null,
    respuesta varchar(200) null,
    reportado_id bigint null,
    PRIMARY KEY (id),
    FOREIGN KEY (tipo_id) REFERENCES  tipos_reporte(id),
    FOREIGN KEY (estado_id) REFERENCES  estados_reporte(id)
);
CREATE TABLE usuarios_x_reportes(
	usuario_id bigint not null,
    reporte_id bigint not null,
    PRIMARY KEY (usuario_id,reporte_id),
    FOREIGN KEY (usuario_id) REFERENCES usuarios(id),
    FOREIGN KEY (reporte_id) REFERENCES reportes(id)
);
CREATE TABLE necesidades(
	id bigint not null auto_increment,
    tipo_id int not null,
    estado_id int not null,
    descripcion varchar(140) not null,
    prioridad tinyint unsigned not null check (prioridad > 0 and prioridad < 6),
    PRIMARY KEY (id),
    FOREIGN KEY (tipo_id) REFERENCES  tipos_necesidad(id),
    FOREIGN KEY (estado_id) REFERENCES  estados_necesidad(id)
);
CREATE TABLE estados_comedor(
	id int not null auto_increment,
    descripcion varchar(50) not null,
    PRIMARY KEY (id)
);
CREATE TABLE comedores(
	id bigint not null auto_increment,
    usuario_id bigint not null,
    renacom bigint not null,
	nombre varchar(50) not null,
    direccion varchar(50) not null,
    localidad varchar(50) not null,
    provincia varchar(50) not null,
    telefono varchar(20) not null,
    nombre_responsable varchar(50) not null,
    apellido_responsable varchar(50) not null,
    estado_id int not null,
    PRIMARY KEY (id),
    FOREIGN KEY (usuario_id) REFERENCES usuarios(id),
    FOREIGN KEY (estado_id) REFERENCES  estados_comedor(id)
);
CREATE TABLE solicitudes(
	id bigint not null auto_increment,
    comedor_id bigint not null,
    fecha_alta date not null,
	estado bit not null default false,
    supervisor_id bigint null,
    PRIMARY KEY (id),
    FOREIGN KEY (supervisor_id) REFERENCES usuarios(id),
    FOREIGN KEY (comedor_id) REFERENCES comedores(id)
);
CREATE TABLE comedores_x_necesidades(
	comedor_id bigint not null,
    necesidad_id bigint not null,
    PRIMARY KEY (comedor_id,necesidad_id),
    FOREIGN KEY (comedor_id) REFERENCES comedores(id),
    FOREIGN KEY (necesidad_id) REFERENCES necesidades(id)
);

insert into estados_necesidad (descripcion) values ("pendiente");
insert into estados_necesidad (descripcion) values ("satisfecha");

insert into tipos_necesidad (descripcion) values ("alimentos");
insert into tipos_necesidad (descripcion) values ("medicinas");
insert into tipos_necesidad (descripcion) values ("herramientas");
insert into tipos_necesidad (descripcion) values ("voluntarios");
insert into tipos_necesidad (descripcion) values ("utiles escolares");
insert into tipos_necesidad (descripcion) values ("utensillos");

insert into estados_reporte (descripcion) values ("en proceso");
insert into estados_reporte (descripcion) values ("completado");

insert into tipos_reporte (descripcion) values ("aplicacion");
insert into tipos_reporte (descripcion) values ("usuario");
insert into tipos_reporte (descripcion) values ("publicacion");

insert into tipos_usuario (descripcion) values ("usuario final");
insert into tipos_usuario (descripcion) values ("administrador de comedor");
insert into tipos_usuario (descripcion) values ("supervisor");

insert into estados_comedor (descripcion) values ("pendiente");
insert into estados_comedor (descripcion) values ("habilitado");

/*USUARIOS SUPERVISOR*/
insert into usuarios(email, password,tipo_id,nombre,apellido,dni)
values('matiledesma@gmail.com', 1234, 3,'matias','ledesma', '11222333');
insert into usuarios(email, password,tipo_id,nombre,apellido,dni)
values('leogerez@gmail.com', 1234, 3,'leonel','gerez', '22333444');
insert into usuarios(email, password,tipo_id,nombre,apellido,dni)
values('alexrodriguez@gmail.com', 1234, 3,'alexis','rodriguez', '33444555');
insert into usuarios(email, password,tipo_id,nombre,apellido,dni)
values('aleolivera@hotmail.com', 1234, 3,'alejandro','olivera', '44555666');

/*USUARIOS FINALES*/
insert into usuarios(nombre, apellido,email,password,tipo_id,dni,direccion,localidad,provincia,telefono,estado)
values('ramon', 'valdez', 'donRamon@hotmail.com','1234','1', '55666777','vecindad 1980', 'virreyes', 'buenos aires','1511112222',1);
insert into usuarios(nombre, apellido,email,password,tipo_id,dni,direccion,localidad,provincia,telefono,estado)
values('angela', 'martin', 'angela@gmail.com','1234','1', '77888999','dunder mifflin 111', 'general pacheco', 'buenos aires','1511113333',1);

/*USUARIOS ADMINSTRADORES DE COMEDOR*/
insert into usuarios(nombre, apellido,email,password,tipo_id,dni,direccion,localidad,provincia,telefono,estado)
values('cosme', 'fulanito', 'cosme@hotmail.com','1234','2', '66777888','calle falsa 123', 'virreyes', 'buenos aires','1522223333',1);
insert into usuarios(nombre, apellido,email,password,tipo_id,dni,direccion,localidad,provincia,telefono,estado)
values('pamela', 'beesley', 'pam@gmail.com','1234','2', '88999000','dunder mifflin 999', 'general pacheco', 'buenos aires','1522224444',1);
insert into usuarios(nombre, apellido,email,password,tipo_id,dni,direccion,localidad,provincia,telefono,estado)
values('rogelio', 'aguas', 'rogelio@gmail.com','1234','2', '11333444','paredes 3344', 'virreyes', 'buenos aires','1533333333',1);
insert into usuarios(nombre, apellido,email,password,tipo_id,dni,direccion,localidad,provincia,telefono,estado)
values('roberto', 'plant', 'roberto@gmail.com','1234','2', '11444333','zepelin 33', 'general pacheco', 'buenos aires','1544443333',1);

/*COMEDORES*/
insert into comedores(usuario_id, renacom,nombre,direccion,localidad,provincia,telefono, nombre_responsable,apellido_responsable,estado_id)
values(7, 11112222, 'comedor cosme','libertador 2303','virreyes', 'buenos aires','1511223344', 'cosme', 'fulanito',2);
insert into comedores(usuario_id, renacom,nombre,direccion,localidad,provincia,telefono, nombre_responsable,apellido_responsable,estado_id)
values(8, 22223333, 'comedor de pamelita','hipolito yrigoyen 2303','general pacheco', 'buenos aires','1522334455', 'pamela', 'beesley',2);
insert into comedores(usuario_id, renacom,nombre,direccion,localidad,provincia,telefono, nombre_responsable,apellido_responsable,estado_id)
values(9, 33224455, 'lo de rogelio','paredes 3203','virreyes', 'buenos aires','1533333333', 'rogelio', 'aguas',1);
insert into comedores(usuario_id, renacom,nombre,direccion,localidad,provincia,telefono, nombre_responsable,apellido_responsable,estado_id)
values(10, 91827364, 'lo de robert','zepelin 44','general pacheco', 'buenos aires','1544443333', 'roberto', 'plant',1);

/*SOLICITUDES*/
insert into solicitudes(comedor_id, fecha_alta,estado,supervisor_id)
values(1,'2018-11-04',1,1);
insert into solicitudes(comedor_id, fecha_alta,estado,supervisor_id)
values(2,'2019-09-12',1,1);
insert into solicitudes(comedor_id, fecha_alta,estado)
values(3,'2020-07-07',0);
insert into solicitudes(comedor_id, fecha_alta,estado)
values(4,'2021-06-24',0);

/*NECESIDADES*/
insert into necesidades(tipo_id, estado_id,descripcion,prioridad)
values(1,1,'necesitamos arroz con mas de 2 meses de vencimiento',3);
insert into necesidades(tipo_id, estado_id,descripcion,prioridad)
values(1,1,'necesitamos alimento enlatado de cualquier tipo',3);
insert into necesidades(tipo_id, estado_id,descripcion,prioridad)
values(3,1,'necesitamos clavos martillo para repara las alacenas',4);
insert into necesidades(tipo_id, estado_id,descripcion,prioridad)
values(2,1,'necesitamos aspirinas o aspirinetas',4);
insert into necesidades(tipo_id, estado_id,descripcion,prioridad)
values(4,1,'necesitamos voluntarios para hacer reparaciones',4);
insert into necesidades(tipo_id, estado_id,descripcion,prioridad)
values(5,1,'necesitamos lapices, gomas y cartucheras para el aÃ±o escolar',4);
insert into necesidades(tipo_id, estado_id,descripcion,prioridad)
values(6,1,'necesitamos platos y vasos de plastico para las meriendas',2);

insert into comedores_x_necesidades(comedor_id, necesidad_id)
values(1,1);
insert into comedores_x_necesidades(comedor_id, necesidad_id)
values(1,2);
insert into comedores_x_necesidades(comedor_id, necesidad_id)
values(1,3);
insert into comedores_x_necesidades(comedor_id, necesidad_id)
values(2,4);
insert into comedores_x_necesidades(comedor_id, necesidad_id)
values(2,5);
insert into comedores_x_necesidades(comedor_id, necesidad_id)
values(2,6);
