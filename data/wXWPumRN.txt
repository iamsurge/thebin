WITH customersWithoutPSPCustomDomain as (
        SELECT
            p.userID
            
            FROM 
              `uptimerobot-001.ur.payments` p
            
            WHERE 
              paymentPeriod IN (1,12)
              AND paymentStatus = 1
              AND  p.userID IN (
                      /*users w/o psp on custom domain*/
                      SELECT
                        userID

                      FROM
                        `uptimerobot-001.ur.psp`

                      WHERE
                        pspCustomDomain IS NULL
                        OR pspCustomDomain= ''

                      GROUP BY
                      userID)

            GROUP BY 
              p.userID) 

SELECT
  customersWithoutPSPCustomDomain.userID,
  userIsProPlan

FROM
  customersWithoutPSPCustomDomain
LEFT JOIN 
  `uptimerobot-001.ur.users` u 

ON
  customersWithoutPSPCustomDomain.userID = u.userID
    
