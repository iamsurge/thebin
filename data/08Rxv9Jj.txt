Write getopt function for C++

#include <unistd.h>
#include <stdio.h>
#include <stdlib.h>

int getopt(int argc, char **argv, char *opstring)
{
    static int charind = 0;
    char *optarg;
    int optopt;
 
    optarg = NULL;
 
    if(charind == 0)
    {
        if (optind >= argc || argv[optind][0] != '-' || argv[optind][1] == '\0')
        {
            return -1;
        }
        else if(strcmp(argv[optind], "--") == 0)
        {
            optind++;
            return -1;
        }
    }
 
    optopt = argv[optind][charind];
 
    if(optopt == ':' || (optopt == '?'))
    {
        fprintf(stderr, "Error: Invalid option.\n");
        return '?';
    }
 
    charind++;
 
    if(argv[optind][charind] == '\0')
    {
        charind = 0;
        optind++;
    }
 
    if(optopt == '-' || (optopt == '?'))
    {
        return -1;
    }
 
    char *p = strchr(opstring, optopt);
 
    if(p == NULL || optopt == ':')
    {
        fprintf(stderr, "Error: Invalid option.\n");
        return '?';
    }
 
    p++;
    if(*p == ':')
    {
        if(optind < argc)
        {
            optarg = argv[optind];
            optind++;
        }
        else
        {
            fprintf(stderr, "Error: Option requires an argument.\n");
            return '?';
        }
    }
    return optopt;
}