local tool = script.Parent

local char = game.Players.LocalPlayer.Character or game.Players.LocalPlayer.CharacterAdded:Wait()
local humanoid = char.Humanoid

local stabAnim = humanoid:WaitForChild("Animator"):LoadAnimation(script:WaitForChild("StabAnimation"))
local throwAnim = humanoid:WaitForChild("Animator"):LoadAnimation(script:WaitForChild("ThrowAnimation"))

local cam = workspace.CurrentCamera
local mouse = game.Players.LocalPlayer:GetMouse()

local rs = game.ReplicatedStorage:WaitForChild("MurderMysteryReplicatedStorage")
local config = require(rs:WaitForChild("CONFIGURATION"))
local re = rs:WaitForChild("RemoteEvent")

local equipped = false
local onCooldown = false

local buttonPressed = nil


tool.Equipped:Connect(function()
	equipped = true
end)
tool.Unequipped:Connect(function()
	equipped = false
end)


mouse.Button1Down:Connect(function()
	if not onCooldown and equipped then
		buttonPressed = tick()
	end
end)

mouse.Button1Up:Connect(function()
	
	if not onCooldown and equipped then
		onCooldown = true
		
		if not buttonPressed or tick() - buttonPressed < config.MurdererWeaponHoldToThrowDuration then
			re:FireServer("MURDERER STAB", tool)
			stabAnim:Play()	
			
		elseif buttonPressed and tick() - buttonPressed >= config.MurdererWeaponHoldToThrowDuration then

			local unitray = cam:ScreenPointToRay(mouse.X, mouse.Y, config.RaycastDepth)
			re:FireServer("MURDERER THROW", tool, unitray)
			
			throwAnim:Play()
		end
		
		task.wait(config.MurdererWeaponCooldown)
		onCooldown = false
	end
end)