local turtle_position = vector.new(0, 0, 0)
local turtle_heading = 1 -- Clockwise, 1 = Forward, 2 = Right, 3 = Back, 4 = Left

local function refuel()
    while turtle.getFuelLevel() < 1 do
        print("Refueling...") -- Debug
        for i = 1, 16 do
            turtle.select(i)
            if turtle.refuel(0) then
                turtle.refuel()
            end
        end
    end
end

local function move_forward()
    turtle.dig()
    if turtle.forward() then
        -- Forward
        if turtle_heading == 1 then
            turtle_position.x = turtle_position.x + 1
        -- Right
        elseif turtle_heading == 2 then
            turtle_position.z = turtle_position.z + 1
        -- Back
        elseif turtle_heading == 3 then
            turtle_position.x = turtle_position.x - 1
        -- Left
        elseif turtle_heading == 4 then
            turtle_position.z = turtle_position.z - 1
        end
        print(turtle_position) -- Debug
        return true
    else
        return false
    end
end

local function move_back()
    if turtle.back() then
        -- Forward
        if turtle_heading == 1 then
            turtle_position.x = turtle_position.x - 1
        -- Right
        elseif turtle_heading == 2 then
            turtle_position.z = turtle_position.z - 1
        -- Back
        elseif turtle_heading == 3 then
            turtle_position.x = turtle_position.x + 1
        -- Left
        elseif turtle_heading == 4 then
            turtle_position.z = turtle_position.z + 1
        end
        print(turtle_position) -- Debug
        return true
    else
        return false
    end
end

local function move_up()
    turtle.digUp()
    if turtle.up() then
        turtle_position.y = turtle_position.y + 1
        print(turtle_position) -- Debug
        return true
    else
        return false
    end
end

local function move_down()
    turtle.digDown()
    if turtle.down() then
        turtle_position.y = turtle_position.y - 1
        print(turtle_position) -- Debug
        return true
    else
        return false
    end
end

local function turn_right()
    if turtle.turnRight() then
        if turtle_heading < 4 then
            turtle_heading = turtle_heading + 1
        else
            turtle_heading = 1
        end
        print(turtle_heading) -- Debug
        return true
    else
        return false
    end
end

local function turn_left()
    if turtle.turnLeft() then
        if turtle_heading <= 1 then
            turtle_heading = 4
        else
            turtle_heading = turtle_heading - 1
        end
        print(turtle_heading) -- Debug
        return true
    else
        return false
    end
end

refuel()
move_forward()
move_forward()
move_forward()
turn_right()
turn_right()
turn_right()
turn_right()
move_forward()
move_up()
move_up()
move_down()
turn_left()
move_forward()
move_forward()
move_back()