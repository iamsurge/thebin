import parsl
import dill

@parsl.python_app
def f(x):
    return x**2

dill._dill._trace(True)

if __name__ == "__main__":
    parsl.load(parsl.config.Config(
        executors=[
            parsl.executors.HighThroughputExecutor(
                provider=parsl.providers.AdHocProvider(
                    channels=[
                        parsl.channels.SSHChannel("worker-0", script_dir="/home/azureuser/tmp")
                    ],
                    worker_init="source $HOME/spack/activate.sh",
                    parallelism=1,
                ),
            ),
        ],
    ))
    print(f(3).result())
