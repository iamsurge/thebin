//---------------------------------------------------------------------------

#include <vcl.h>
#pragma hdrstop

#include "TradeUnit.h"
//---------------------------------------------------------------------------
#pragma package(smart_init)
#pragma resource "*.dfm"
TTradeForm *TradeForm;
//---------------------------------------------------------------------------
__fastcall TTradeForm::TTradeForm(TComponent* Owner)
	: TForm(Owner)
{
}
//---------------------------------------------------------------------------
void __fastcall TTradeForm::ImageCancelClick(TObject *Sender)
{
	MainForm->ImageTranspanent->Visible = false;
    MainForm->Enabled = true;
	TradeForm->Hide();
	ComboBoxCells->Clear();
	ComboBoxOtherCells->Clear();
	EditCash->Text = "0";
	EditTradeCash->Text = "0";
}
//---------------------------------------------------------------------------
void __fastcall TTradeForm::FormShow(TObject *Sender)
{
    SpinEditPlayer->Value = 2;
	listOfCells = MainForm->GetListOfCells();
	for (int i = 1; i < listOfCells.size(); i++)
	{
		ComboBoxCells->Items->Add(listOfCells[i]->getName());
	}

	listOfTradeCells = MainForm->GetListOfOtherCells(2);
	for (int i = 1; i < listOfTradeCells.size(); i++)
	{
		ComboBoxOtherCells->Items->Add(listOfTradeCells[i]->getName());
	}
}
//---------------------------------------------------------------------------
void __fastcall TTradeForm::ImageSellClick(TObject *Sender)
{
	int index1 = ComboBoxCells->Items->IndexOf(ComboBoxCells->Text) + 1;
	int index2 = ComboBoxOtherCells->Items->IndexOf(ComboBoxOtherCells->Text) + 1;

	if (index1 > 0 || index2 > 0)
	{
		int position1 = listOfCells[index1]->getNumber();
		int position2 = listOfTradeCells[index2]->getNumber();
		int cash1 = StrToInt(EditCash->Text);
		int cash2 = StrToInt(EditTradeCash->Text);
		MainForm->Trade(position1, position2, cash1, cash2, 0, SpinEditPlayer->Value - 1);
	}
	ImageCancelClick(Sender);
}
//---------------------------------------------------------------------------
void __fastcall TTradeForm::SpinEditPlayerChange(TObject *Sender)
{
	int player = SpinEditPlayer->Value;
    ComboBoxOtherCells->Clear();
	listOfTradeCells = MainForm->GetListOfOtherCells(player);
    for (int i = 1; i < listOfTradeCells.size(); i++)
	{
		ComboBoxOtherCells->Items->Add(listOfTradeCells[i]->getName());
	}
}
//---------------------------------------------------------------------------
void __fastcall TTradeForm::SpinEditPlayerKeyPress(TObject *Sender, System::WideChar &Key)

{
	Key = 0;
}
//---------------------------------------------------------------------------
