local motor = peripheral.wrap("right")

sleep(1)

local function transition(options)
  local currentSpeed = motor.getSpeed()
  local endSpeed = options.endSpeed
  local accSpeed = options.accSpeed or 32
  local invert = currentSpeed > endSpeed
  if invert then accSpeed = -accSpeed end

  print()
  print("[accelerate] " .. currentSpeed .. " -> " .. endSpeed)

  for speed = currentSpeed, endSpeed, accSpeed do
    print("Speed: " .. speed .. ", Should break?: " .. tostring(speed == endSpeed))
    motor.setSpeed(speed)
    sleep(0.5)
  end

  print("Ending acceleration")
  print()
end

transition({ endSpeed = 256 })
sleep(1.5)

transition({ endSpeed = 0 })
sleep(1.5)

transition({ endSpeed = -256 })
sleep(1.5)

transition({ endSpeed = 0 })
sleep(1.5)


motor.stop()
