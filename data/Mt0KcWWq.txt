getDistanceBetweenCheck = function(p1, p2)
    if p1 and p2 and p1.x and p1.y and p2.x and p2.y then
        return math.max(math.abs(p1.x - p2.x), math.abs(p1.y - p2.y))
    end
end
safeDistance = macro(10, "Safe Distance", function()
local target = g_game.getAttackingCreature()
    if not safeDistance.isOn() then return end
    if not g_game.isAttacking() then return end
    if getDistanceBetweenCheck(pos(), target:getPosition()) > 6 then
      TargetBot.setOff()
        g_game.attack(nil)
          g_game.cancelAttack()
            schedule(200, function() TargetBot.setOn() end)
    end
end)

 macro(1, "TargetBotOff - Players", function()
  if not CaveBot.isOn() then return end
    if getPlayers() > 0 then
      TargetBot.setOff()
      g_game.attack(nil)
      g_game.cancelAttack()
    else
      TargetBot.setOn()
    end
end)
