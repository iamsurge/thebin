    SELECT
        COALESCE(JSON_EXTRACT_SCALAR(t1.data, '$.collection_id'), JSON_EXTRACT_SCALAR(t1.data, '$.search_params.collection')) collection_id,
        CAST(FROM_UNIXTIME(t1.log_timestamp / 1000) AT TIME ZONE 'America/Sao_Paulo' AS DATE) grass_date,
        COUNT(DISTINCT COALESCE(CAST(t1.userid AS VARCHAR), t1.deviceid)) impression_unique_count
    FROM traffic.shopee_traffic_dwd_impression_hi__br_s1_live AS t1
        -- INNER JOIN microsites_collections AS m_col
        --     ON CAST(JSON_EXTRACT_SCALAR(t1.data, '$.collection_id') AS BIGINT) = m_col.collection_id
    WHERE t1.page_type IN ('search', 'collection', 'search_in_collection')
        AND t1.operation = 'impression'
        AND COALESCE(JSON_EXTRACT_SCALAR(t1.data, '$.collection_id'), JSON_EXTRACT_SCALAR(t1.data, '$.search_params.collection')) IS NOT NULL
        AND CAST(FROM_UNIXTIME(t1.log_timestamp / 1000) AT TIME ZONE 'America/Sao_Paulo' AS DATE) = DATE('2022-11-11')
        AND CAST(JSON_EXTRACT_SCALAR(t1.data, '$.collection_id') AS BIGINT) = 1214603
    GROUP BY 1,2