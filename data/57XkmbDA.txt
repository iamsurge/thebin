    .text
    .global partition
    // ebx - начало, esi - size, edi - pivot, edx - mid
partition:
    pushl %esi
    decl %esi // right - 1
    movw (%ebx, %esi, 2), %cx
    cmpw %di, %cx
    jz fin_end
    xorl %edx, %edx // left
    cmpl %esi, %edx
    jle loop
    loop:
        movw (%ebx, %edx, 2), %cx
        cmpw %di, %cx
        jle inc_left
        movw (%ebx, %esi, 2), %cx
        cmpw %cx, %di
        jle dec_right
        cmpl %esi, %edx
        jle change_sides
        jmp fin
    inc_left:
        incl %edx
        jmp loop
    dec_right:
        decl %esi
        jmp loop
    change_sides:
        movw (%ebx, %edx, 2), %cx
        pushw %cx
        movw (%ebx, %esi, 2), %ax
        movw %ax, (%ebx, %edx, 2)
        popw %ax
        movw %ax, (%ebx, %esi, 2)
        incl %edx
        decl %esi
        jmp loop
    fin:
        popl %esi
        ret
    fin_end:
        movl %esi, %edx
        popl %esi
        ret