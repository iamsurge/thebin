local event = require("event")
local com = require ("component")
local modem
local rs = com.redstone
local port = 9999
local started = false

local function onModemMessage(_, _, snd, prt, _, ...)
  print(prt)
  if prt ~= port then
    return
  end
end

function start()
  if not component.isAvailable("modem") then
    io.stderr:write("Сетевая карта не найдена!")
    return
  end
  if started then
    io.stderr:write("Сервер уже запущен!")
    return
  end
  
  started = true   
  port = args or 9999
  modem = com.modem
  modem.open(port)
  event.listen("modem_message", onModemMessage)
end

function stop()
  if not started then
    io.stderr:write("Сервер уже выключен!")
    return
  end 
  started = false   
  event.ignore("modem_message", onModemMessage)
end
 
while true do
  e = {event.pull('modem_message')}
  if e[6] then 
    if e[6] == "off" then 
	rs.setOutput(0, 0)
    rs.setOutput(1, 0)
    rs.setOutput(2, 0)
    rs.setOutput(3, 0)
    rs.setOutput(4, 0)
    rs.setOutput(5, 0)
	computer.beep(1000, 1)
	 elseif e[6] == "on" then 
	 rs.setOutput(0, 255)
     rs.setOutput(1, 255)
     rs.setOutput(2, 255)
     rs.setOutput(3, 255)
     rs.setOutput(4, 255)
     rs.setOutput(5, 255)
     computer.beep(1000, 1)
	 computer.beep(1000, 1)
	  elseif e[6] == "stop" then 
	  break
    end
  end
end