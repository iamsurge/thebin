#define _USE_MATH_DEFINES 
#include <iostream>
#include <iomanip>
#include <vector>
#include <random>
#include <chrono>
#include <cmath>
#include <ctime>
using namespace std;
using namespace chrono;

typedef vector <double> vec;
typedef vector <vec> mat;

const double v = 10, EPS = 1e-5;

double F_A(int k, int j, double x)
{
    return pow(x, k + j + 1) / (k + j + 1);
}

double A(int k, int j, double a, double b)
{
    return F_A(k, j, b) - F_A(k, j, a);
}

double F_phi(int j, double x)
{
    return v * ((pow(x, j + 2) * 4 / 3 / (j + 2)) + (pow(x, j + 3) / 4 / (j + 3)) + (pow(x, j + 4) / 5 / (j + 4)));
}

double phi(int j, double a, double b)
{
    return F_phi(j, b) - F_phi(j, a);
}

vec Gauss(mat A, vec b)
{
    int n = b.size();

    // прямой ход
    for (int i = 0; i < n; ++i)
    {
        if (fabs(A[i][i]) < 1e-5)
        {
            int m = i;

            for (int k = i + 1; k < n; ++k)
                if (fabs(A[k][i]) > fabs(A[m][i])) m = k;

            swap(b[i], b[m]);

            for (int j = i; j < n; ++j)
                swap(A[i][j], A[m][j]);
        }

        // нормируем строку 
        for (int j = i + 1; j < n; ++j)
            A[i][j] /= A[i][i];

        // нормируем строку
        b[i] /= A[i][i]; A[i][i] = 1;

        // вычитаем из нижних строк текущую строку
        // получаем в i-ом столбце нули
        for (int k = i + 1; k < n; ++k)
        {
            for (int j = i + 1; j < n; ++j)
                A[k][j] -= A[i][j] * A[k][i];

            b[k] -= b[i] * A[k][i];
        }
    }

    vec x(n);

    // обратный ход
    for (int i = n - 1; i >= 0; --i)
    {
        x[i] = b[i];

        for (int j = i + 1; j < n; ++j)
            x[i] -= A[i][j] * x[j];
    }

    return x;
}

void print(vec& a)
{
    int n = a.size();

    cout << "Вектор: (";

    for (int i = 0; i < n - 1; ++i)
        cout << a[i] << ", ";

    cout << a[n - 1] << ")\n\n";
}

void print(mat& A, vec& b)
{
    int n = b.size();

    cout << "Матрица СЛУ имеет вид:\n";

    for (int i = 0; i < n; ++i, cout << "\n")
    {
        for (int j = 0; j < n; ++j)
            cout << left << setw(8) << A[i][j];

        cout << "| " << b[i];
    }

    cout << "\n";
}

int main()
{
    setlocale(LC_ALL, "Russian");
    cout << fixed << setprecision(2);

    int n = 3;

    mat matrix(n, vec(n));

    for (int k = 0; k < n; ++k)
        for (int j = 0; j < n; ++j)
            matrix[k][j] = A(k + 1, j + 1, 0, 1) + (k == j);

    vec b(n);

    for (int j = 0; j < n; ++j)
        b[j] = phi(j + 1, 0, 1);

    print(matrix, b);

    vec q = Gauss(matrix, b);

    cout << "Точное решение: " << v << " * x\n";
    cout << "Приближенное решение: (x * " << 4 * v << " / 3) + (x^2 * " << v << " / 4) + (" << "x^3 * " << v << " / 5)";

    for (int k = 0; k < n; ++k)
    {
        cout << " - (" << q[k] << " * x";
        if (k) cout << "^" << k + 1;

        cout << ")";
    }

    return 0;
}   