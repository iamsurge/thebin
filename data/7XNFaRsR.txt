import os
import struct

def readNullTerminatedString(f):
    result=b""
    while 1:
        byte=f.read(1)
        if byte==b"\x00": break
        result+=byte

    return result.decode()

def parseSBP(fname):
    f=open(fname,"rb")
    hdrbase=0x60
    f.seek(hdrbase+0x0c)
    numNames,bnkOffset,bnkSize=struct.unpack("<III",f.read(0x0c))
    f.seek(hdrbase+0x30)
    bnkName=readNullTerminatedString(f)
    print(bnkName)

    for i in range(numNames):
        f.seek(hdrbase+0x68+0x48*i+0x10)
        name=readNullTerminatedString(f)
        wwNames.append(name)
        print(name)

    f.seek(hdrbase+bnkOffset)
    data=f.read(bnkSize)
    fout=open(bnkName+".bnk","wb")
    fout.write(data)
    fout.close()

wwNames=list()

if __name__=="__main__":
    for fname in os.listdir():
        if not fname.endswith(".sbp"):
            continue

        parseSBP(fname)

    f=open("wwnames.txt","w")
    for name in wwNames:
        f.write(name+"\n")
    f.close()
