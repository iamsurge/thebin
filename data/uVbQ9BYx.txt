    SELECT
        COALESCE(JSON_EXTRACT_SCALAR(t1.data, '$.collection_id'), JSON_EXTRACT_SCALAR(t1.data, '$.search_params.collection')) AS collection_id,
        CAST(FROM_UNIXTIME(t1.log_timestamp / 1000) AT TIME ZONE 'America/Sao_Paulo' AS DATE) AS grass_date,
        COUNT(DISTINCT COALESCE(CAST(t1.userid AS VARCHAR), t1.deviceid)) AS view_unique_count
    FROM traffic.shopee_traffic_dwd_view_hi__br_s1_live AS t1
        -- INNER JOIN microsites_collections AS m_col
        --     ON CAST(JSON_EXTRACT_SCALAR(t1.data, '$.collection_id') AS BIGINT) = m_col.collection_id
    WHERE ((t1.page_type IN ('search', 'collection', 'search_in_collection')) 
        AND (t1.operation = 'view')
        AND (COALESCE(JSON_EXTRACT_SCALAR(t1.data, '$.collection_id'), JSON_EXTRACT_SCALAR(t1.data, '$.search_params.collection')) IS NOT NULL) 
        AND (TRY_CAST(COALESCE(JSON_EXTRACT_SCALAR(t1.data, '$.collection_id'), JSON_EXTRACT_SCALAR(t1.data, '$.search_params.collection')) AS BIGINT) IS NOT NULL)
        AND (DATE((FROM_ISO8601_TIMESTAMP(datehour) - INTERVAL  '3' HOUR)) <=  CAST(current_timestamp AT TIME ZONE 'America/Sao_Paulo' AS DATE)) 
        AND (DATE((FROM_ISO8601_TIMESTAMP(datehour) - INTERVAL  '3' HOUR)) >=  DATE_ADD('DAY', -91, CAST(current_timestamp AT TIME ZONE 'America/Sao_Paulo' AS DATE)))
        AND CAST(FROM_UNIXTIME(t1.log_timestamp / 1000) AT TIME ZONE 'America/Sao_Paulo' AS DATE) >= DATE_ADD('DAY', -91, CAST(current_timestamp AT TIME ZONE 'America/Sao_Paulo' AS DATE)))
        AND CAST(JSON_EXTRACT_SCALAR(t1.data, '$.collection_id') AS BIGINT) = 1214603
    GROUP BY 1, 2