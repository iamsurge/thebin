local version = "0.02"
-- Script by Kotevski


-- Skips a single line
local function skip_line()
    print(" ")
end


-- Takes user input in a fancy way
local function prep_input(prompt)
    term.setCursorPos(1, 18)
    term.write("--------------------------------------------------")
    term.setCursorPos(1, 19)
    term.write(prompt.." ")
    response = read()
    return response
 end


-- Clear the screen and reset the cursor position
local function clear()
   term.setBackgroundColor(colours.black)
   term.clear()
   term.setCursorPos(1,1)
   print("ccCommander v"..version.." by Kotevski")
   skip_line()
end


-- Really stupid shit added for asthetics
local function pretty()
   sleep(.005)
end


-- Remove a string from a table
local function purge_string(local_called_string, local_called_table)
   for key, value in pairs(local_called_table) do
       if value == local_called_string then
           table.remove(local_called_table, key)
           return local_called_table
       end
   end
end


-- User input checker, iterates through 
-- target input list to see if its there
local function verify_input(local_called_input, local_called_target)
    for key, value in pairs(local_called_target) do
        if value == local_called_input then
            return 1
        end
    end
    return 0
end


-- Modem Detection, returns the side the modem is on
local function detect_modem()
    side_list = {"top", "bottom", "left", "right", "front", "back"}
    for key, value in pairs(side_list) do
        if peripheral.isPresent(value) then
            if peripheral.getType(value) == "modem" then
                return value
            end
        end
    end
    print("ERROR: NO MODEM DETECTED! ADD AN ENDER MODEM!")
    os.exit()
end


-- Sends a message out to all the servers, asking who is there, will wait for about 10 seconds for responses and then stop
local function ping_network_devices()
	network_directory = {}
	rednet.broadcast("ping", "Fortuna")
	timeout = 10
	while timeout ~= 0 do
		senderId, message = rednet.receive("Fortuna", 1)
		if type(message) == "table" then
			if message ~= "ping" then
				network_directory[senderId] = message
				print("Online Functions from Controller "..senderId)
				for key, value in pairs(message) do
					if value["Name"] ~= nil then
						print(" -"..value["Name"].." is "..value["State"])
					end
				end
			end
		end
		timeout = timeout -1
	end
end


-- Main runtime
local function main()
	modem_side = detect_modem()
	rednet.open(modem_side)
	while true do 
		clear()
		skip_line()
		
		print("Searching for network devices...\n")
		master_directory = ping_network_devices()
		
		user_input = prep_input("Command:" )
		print("User said " .. user_input)
	end
end

main()

sleep(2)