 SELECT
        S.SALE_INVO_NO,
        S.ORG_INVO_NO ,
        TO_CHAR(S.SEND_DMT,
        'DD/MM/YYYY') AS SEND_DMT ,
        TO_CHAR(S.DELIV_END_DMT,
        'DD/MM/YYYY') AS DELIV_END_DMT ,
        (SUM(C.ROW_SUM) + SUM(GET_PNL_BYINVO(S.DELIV_END_DMT,
        S.SALE_INVO_NO))) AS TOTAL,
        SUM(GET_PNL_BYINVO(S.DELIV_END_DMT,
        S.SALE_INVO_NO)) AS PENALTI,
        US_FI.GETCDNM(S.USE_CURY) AS USE_CURY_NM
    FROM
        US_FI.TBFI_WARNING_LETTERS SD ,
        US_FI.TBFI_SALE_INVO S,
        US_FI.TBFI_SALE_INVO_DETL C
    WHERE
        SD.SALE_INVO_NO = S.SALE_INVO_NO
        AND S.SALE_INVO_NO  = C.SALE_INVO_NO
        AND SD.DOC_NO =${doc_no}
    GROUP BY
        S.SALE_INVO_NO,
        S.ORG_INVO_NO,
        S.SEND_DMT,
        S.DELIV_END_DMT,
        SD.DOC_AMT,
        S.USE_CURY
    ORDER BY
        S.SALE_INVO_NO
