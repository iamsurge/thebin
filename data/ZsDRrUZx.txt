lass Solution {

    /**
     * @param String[][] $board
     * @param String[] $words
     * @return String[]
     */

    function findWords($board, $words) {

        $row=sizeof($board);
        $col=sizeof($board[0]);

		global $output;
        $output=[];

		global $tree;
        $tree=[];
        foreach($words as $word){
            insertword($tree,$word);
        }

		for($i=0;$i<$row;$i++){
			for($j=0;$j<$col;$j++){
                if (!empty($tree)){
                    buildTree($tree, $board, $i, $j, $row, $col, "");
                }
                else
                    break;
			}
		}
        return $output;
    }
}

function insertword(&$node,$word){

    if($word==""){
        $node[0]=3;
        return;
    }

    $char=substr($word, 0, 1);
    $word=substr($word, 1);

    if(empty($node[$char]))
        $node[$char]=[];

    insertword($node[$char],$word);
}

function buildTree(&$parent, &$board, $i, $j, $row, $col, $w){

    $p=$w.$board[$i][$j];

    $temp=$board[$i][$j];
    $board[$i][$j]=false;

    if($parent[$temp][0]==3){
            global $output;
            $output[]=$p;
            global $tree;
            removeWord($tree,$p);
    }

    if($i+1<$row && $board[$i+1][$j]!=false && !empty($parent[$temp][$board[$i+1][$j]])){
        buildTree($parent[$temp], $board, $i+1, $j, $row, $col, $p);
    }
    if($i-1>=0 && $board[$i-1][$j]!=false && !empty($parent[$temp][$board[$i-1][$j]])){
        buildTree($parent[$temp], $board, $i-1, $j, $row, $col, $p);
    }
    if($j-1>=0 && $board[$i][$j-1]!=false && !empty($parent[$temp][$board[$i][$j-1]])){
        buildTree($parent[$temp], $board, $i, $j-1, $row, $col, $p);
    }
    if($j+1<$col && $board[$i][$j+1]!=false && !empty($parent[$temp][$board[$i][$j+1]])){
        buildTree($parent[$temp], $board, $i, $j+1, $row, $col, $p);
    }
    
    $board[$i][$j]=$temp;

    return;
}

function removeWord(&$parent,$word){
    
    if(strlen($word)==0){
        if($parent[0]==3){
            unset($parent[0]);
        }

        if(empty($parent)){
            unset($parent);
            return true;
        }
        return false;
    }
    else{
        $char=substr($word, 0, 1);
        $word=substr($word, 1);
        if(removeWord($parent[$char],$word)){
            if(empty($parent[$char])){
                unset($parent[$char]);
                return true;
            }
        }
        return false;
    }
}