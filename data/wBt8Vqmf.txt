 */function init(){return new Promise(function(n,t){chrome.storage.local.get(function(i){var v=chrome.runtime.lastError,e,h,r,u,l,c,a,o,s,f;if(v){t(v.message);return}for(oLS=i,bActiveCat=!!oLS.other.activecat,bDebug=!!oLS.other.debug,bException=!1,r=0;r<i.exceptions.length;++r){try{re=new RegExp(i.exceptions[r],"im")}catch(y){bDebug&&console.warn("["+sExtName+"] Exception "+i.exceptions[r]+" is invalid. Skipping...");re=/^\b$/}if(re.test(sSiteHaystack)){bException=!0;D.removeEventListener("keydown",handleKeyDown);t("Autofilling is disabled for "+D.URL+" because "+(self===top?"this page":"the parent frame")+' matches "'+i.exceptions[r]+'" on the Exceptions list.');return}}if(e=JSON.parse(oLS.rules),h=location.host?sHost+location.pathname:location.pathname.replace(/^.+?\//,"/"),sSite=location.host?sHost:h.replace(/(.+)\/.+$/,"$1"),oLS.other.sitefilters)switch(oLS.sitefilters){case 0:sSite=h;break;case 1:sSite=h+location.search;break;case 2:sSite=h+location.search+location.hash}for(sSite=escapeRegex(sSite),oCats={},r=0;r<oLS.cats.length;++r)oCats[oLS.cats[r].k]={n:oLS.cats[r].n,s:oLS.cats[r].s};for(oAdvanced={},r=0;r<oLS.advanced.length;++r)if(u=oLS.advanced[r].split(":"),u[0]=u[0].trim().toLowerCase(),u.length===2&&(oCats[u[0]]||e[u[0]]))for(l=u[1].trim().split(/ +/),c=0;c<l.length;++c)if(!(l[c].indexOf("=")<1)){a=l[c].split("=");o=a[0].toLowerCase();s=a[1].toLowerCase();switch(o){case"delay":if(s=+s,isNaN(s)||s<=0)continue;oAdvanced[u[0]]||(oAdvanced[u[0]]={});oAdvanced[u[0]][o]=s;break;default:(o==="all"||o==="forcefill")&&a[1]==="true"&&(oAdvanced[u[0]]||(oAdvanced[u[0]]={}),oAdvanced[u[0]][o]=!0)}}sCatCurrent=getCatId(oLS.catnow);oLS.rules={};for(f in e)re=new RegExp(getVar(e[f].s)||oCats[e[f].c]&&oCats[e[f].c].s||".","im"),re.test(sSiteHaystack)&&(oLS.rules[f]=e[f],oLS.other.manual&&(oAdvanced[f]&&oAdvanced[f].forcefill||oAdvanced[oLS.rules[f].c]&&oAdvanced[oLS.rules[f].c].forcefill)&&(oForceFill||(oForceFill={}),oForceFill[f]=e[f]));e=undefined;oLS.other.manual||(oForceFill=undefined);bManual=!!(oLS.other.manual&&!(oAdvanced[sCatCurrent]&&oAdvanced[sCatCurrent].forcefill)&&!oForceFill);D.getElementById("autofill-wizard")&&Wizard.updateCats();D.addEventListener("keydown",handleKeyDown);D.dispatchEvent(new Event("init"));n()})})}function initFields(n,t){var e,i,u,f,r;if(n)for(e=0;e<n.length;++e)if(i=n[e],u=i.type,!i.disabled&&!i.hidden&&!i.readOnly&&u!=="hidden"&&(i.nodeName!=="DIV"||!i.hasAttribute("aria-checked"))&&(i.nodeName!=="SELECT"||!isZendesk))if(i.backup=oLS.other.backup&&u!=="password",i.nodeName==="IFRAME"){if(!validIframe(i))continue;i.sync=t;i.onload=function(){initFields([this],this.sync)};f=getIframe(i);f instanceof Array?initFields(f,t):typeof f=="string"&&initHtmlField(i,f)}else i.nodeName==="DIV"&&i.getAttribute("aria-selected")==="true"?i.parentNode.initialValue=(i.getAttribute("data-value")||"").trim():(t||(r=mInitial.get(i),u==="checkbox"||u==="radio"?r===undefined?(i.initialValue=i.checked,mInitial.set(i,i.initialValue)):i.initialValue=r:i.multiple?r===undefined?(i.initialValue=getSelOptions(i),mInitial.set(i,i.initialValue)):i.initialValue=r:(i.isContentEditable?initHtmlField(i,getHtml(i.innerHTML)):r===undefined?(i.initialValue=i.value,mInitial.set(i,i.initialValue)):i.initialValue=r,i.initialClass=typeof i.className=="string"?i.className.trim():"")),i.backup?i.addEventListener("input",backupField):i.removeEventListener("input",backupField))}function initHtmlField(n,t){if(n.timer===undefined||n.sync){var i,f=0,u=0,r;n.initialValue=t;n.timer=setInterval(function(n){if(n.isContentEditable)i=n,r=!0;else try{i=n.contentDocument&&n.contentDocument.body;r=n.contentDocument&&n.contentDocument.readyState==="complete"}catch(t){clearInterval(n.timer);return}if(i)if(n.sync||r&&getHtml(i.innerHTML)===n.initialValue){if(n.sync||++u==3){clearInterval(n.timer);n.isContentEditable||(n.backup?i.addEventListener("input",backupField):i.removeEventListener("input",backupField),i.setAttribute(sHighlight,"false"),i.addEventListener("blur",handleIframeBlur),i.addEventListener("focus",handleIframeFocus));n.done=!0;n.sync||n.dispatchEvent(new Event("done"));return}}else n.sync||(n.initialValue=getHtml(i.innerHTML)),u=0;++f==100&&clearInterval(n.timer)},100,n)}}function Autofill(n,t,i,r){var rt,kt,l,c,it,v,et,at,vt,s,ot,yt,st,pt,wt,f,bt;if(typeof n=="string"){switch(n){case"":rt=2;break;case"all":rt=1;break;default:for(c=0;c<oLS.cats.length;++c)if(oLS.cats[c].k===n){rt=c+5;break}}rt&&(kt=setInterval(function(n){performance.now()-D.autofilled>200&&(clearInterval(kt),setTimeout(function(n){sendMessage({type:"executeRules",data:{catnow:n}})},n.delay,n.catnow))},100,{catnow:rt,delay:typeof t=="number"?t:0}));return}if(l=r?r:oForceFill||oLS.rules,Object.keys(l).length!==0){var u,k,h,e,y,nt={},tt,o,a={},ht={},p=[],dt=[],w=0,gt,ni="abcdefghijklmnopqrstuvwxyz",ti="0123456789",ct=ni+ni.toUpperCase()+ti+ti,d,ut,b,lt=function(n,t,i){if(n&&(n.type!==undefined||n.innerHTML!==t)){var r=n.value===undefined?n.innerHTML:n.value;switch(n.afMode===undefined?o.o:n.afMode){case 2:t+=r;break;case 3:t=r+t;break;case 4:t=t+r+t;break;case 5:t=isNaN(r)?r:++r;break;case 6:t=isNaN(r)?r:--r}n.focus({preventScroll:!0});n.value===undefined?n.innerHTML=t:n.value=t;fire(n,["keydown","keypress","input","keyup"]);log(i,n);++w}},ft=function(n){var u,i,t,r;if(n.id)try{if(t=D.querySelector('[for="'+escapeStr(n.id)+'"]'),t&&b.test(t.textContent.trim()))return!0}catch(f){}if((u=n.getAttribute("aria-labelledby")||n.getAttribute("aria-describedby"),u&&(t=D.getElementById(u),t&&b.test(t.textContent.trim())))||isGForms(n)&&(i=getParent(n,"[role=listitem]"),t=i&&i.querySelector(".freebirdFormviewerComponentsQuestionBaseHeader"),t&&b.test(t.innerText.replace(/^ *(.+?) *$/gm,"$1"))&&(n.classList.contains("quantumWizTextinputPaperinputInput")||e===(n.getAttribute("data-value")||"").trim()))||isMOForms(n)&&(i=getParent(n,".office-form-question-content"),t=i&&i.querySelector(".text-format-content"),t&&b.test(t.textContent.trim()))||(r=(n.getAttribute("aria-label")||"").trim()+"\n"+(n.name||"").trim()+"\n"+n.id.trim()+"\n"+(n.getAttribute("aria-labelledby")||"").trim()+"\n"+(n.getAttribute("aria-describedby")||"").trim()+"\n"+(n.getAttribute("data-bind")||"").trim()+"\n"+(n.getAttribute("data-reactid")||"").trim()+"\n"+(n.getAttribute("ng-model")||"").trim()+"\n"+n.title.trim()+"\n"+(n.placeholder||"").trim()+"\n"+(n.initialClass||"")+"\n"+(typeof n.className=="string"?n.className.trim():""),(n.type==="checkbox"||n.type==="radio")&&n.value!=="on"?r+="\n"+n.value.trim():n.src&&n.src.indexOf(location.origin)===0&&n.src!==D.URL&&(r+="\n"+n.src),b.test(r))||n.parentNode&&n.parentNode.nodeName==="LABEL"&&b.test(n.parentNode.textContent.trim()))return!0;try{return n===D.querySelector(h.replace(/\\/g,""))}catch(f){}return!1},g=function(n,t){var r,e,s,u,c,v,d,y,w,b,h,k,a,i,l;if(oLS.other.vars){if(n=getVar(n),o.t===4)return n;if((u=/\{[nv]\d+\}/g).test(n))for(r=n.match(u),i=0;i<r.length;++i)u=new RegExp(r[i]),c=r[i].replace(/\D+/g,""),v=r[i].slice(1,2),oLS.rules["r"+c]&&oLS.rules["r"+c][v]!==undefined&&(d=v==="v"&&ht["r"+c]?ht["r"+c]:oLS.rules["r"+c][v],n=n.replace(u,d));if(t)return n;if((u=/\{-?\d+(\+\+|\+\d+|--|-\d+)\}/g).test(n)){for(s=n,r=n.match(u),i=0;i<r.length;++i)u=new RegExp(r[i].replace(/(\+\+|\+\d+|--|-\d+)/,"($1)").replace(/\+/g,"\\+")),y=+r[i].replace(/\{(-?\d+).+/,"$1"),w=r[i].indexOf("++")>0?1:r[i].indexOf("--")>0?-1:+r[i].replace(/.+?([+-]\d+).+/,"$1"),n=n.replace(u,y+w),s=s.replace(u,"{``"+(y+w)+"``$1}");o.v=s.replace(/``(\d+)``/g,"$1");p.push({key:f,obj:o})}if((u=/\{\([^,|}\r\n]*(\|?[^,|}\r\n]*)+\)\}/g).test(n)){for(s=s||n,r=n.match(u),i=0;i<r.length;++i)u=new RegExp(escapeRegex(r[i])),e=r[i].substring(2,r[i].length-2).split(/(?<!\\)\|/),b=R(0,e.length-1),n=n.replace(u,e[b].replace(/\\(?!\\)/g,"")),e.splice(b,1),s=s.replace(u,"{``("+e.join("|")+")``}");o.v=s.replace(/``(\(.+?\))``/g,"$1").replace(/{``\(\)``}/g,"");p.push({key:f,obj:o})}if((u=/\{\([^,}\r\n]*(,[^,}\r\n]*)+\)\}/g).test(n)){for(s=s||n,r=n.match(u),i=0;i<r.length;++i)u=new RegExp(escapeRegex(r[i])),e=r[i].substring(2,r[i].length-2).split(/(?<!\\),/),n=n.replace(u,e[0].replace(/\\(?!\\)/g,"")),e.shift(),s=s.replace(u,"{``("+e.join(",")+")``}");o.v=s.replace(/``(\(.+?\))``/g,"$1").replace(/{``\(\)``}/g,"");p.push({key:f,obj:o})}if((u=/\{[^|}\r\n]*(\|[^|}\r\n]*)+\}/g).test(n))for(r=n.match(u),i=0;i<r.length;++i)u=new RegExp(escapeRegex(r[i])),e=r[i].substring(1,r[i].length-1).split(/(?<!\\)\|/),n=n.replace(u,e[R(0,e.length-1)].replace(/\\(?!\\)/g,""));if((u=/\{[^,}\r\n]*(,[^,}\r\n]*)+\}/g).test(n)){for(r=n.match(u),i=0;i<r.length;++i)u=new RegExp(escapeRegex(r[i])),h=r[i].substring(1,r[i].length-1),e=h.split(/(?<!\\),/),o.hasOwnProperty(h)||(o[h]=0),n=n.replace(u,e[o[h]].replace(/\\(?!\\)/g,"")),e[++o[h]]===undefined&&(o[h]=0);p.push({key:f,obj:o})}if((u=/\{[#$]\d*\}/g).test(n))for(r=n.match(u),i=0;i<r.length;++i){if(u=new RegExp(r[i].replace("$","\\$")),k=+r[i].replace(/\D/g,"")||1,r[i].indexOf("#")>0)for(a=R(1,9),l=1;l<k;++l)a+=R(0,9)+"";else for(a=ct.charAt(R(0,51)),l=1;l<k;++l)a+=ct.charAt(R(0,ct.length-1));n=n.replace(u,a)}}return n};if(!(n instanceof Array))for(n=queryBySelector(sFillable),c=0;c<aFO.length;++c)n.indexOf(aFO[c])<0&&n.push(aFO[c]);gt=n.length;D.autofilling=performance.now();for(f in l)t?oCats[l[f].c]&&oCats[l[f].c].n===sBackup+sHost&&(a[f]=l[f]):bActiveCat&&sCatCurrent!=="all"?(l[f].c===sCatCurrent||oAdvanced[l[f].c]&&oAdvanced[l[f].c].all||oAdvanced[f]&&oAdvanced[f].all)&&(a[f]=l[f]):(l[f].c===""||oCats[l[f].c]&&oCats[l[f].c].n.indexOf(sBackup)<0)&&(a[f]=l[f]);if(Object.keys(a).length!==0){for(t||i||n.push(D.createElement("input")),c=0;c<n.length;++c)if(u=n[c],d=u.nodeName==="DIV"&&u.getAttribute("aria-checked")||null,ut=u.nodeName==="DIV"&&u.getAttribute("aria-selected")||null,!u.disabled&&!u.readOnly){k=u.type;for(f in a)if(o=a[f],r||!(oAdvanced[o.c]&&oAdvanced[o.c].delay||oAdvanced[f]&&oAdvanced[f].delay)){switch(o.t){case 0:if(k==="password"||k==="checkbox"||k==="radio"||u.nodeName==="SELECT"||d!==null||ut!==null)continue;break;case 1:if(k!=="password")continue;break;case 2:if(u.nodeName!=="SELECT"&&ut===null)continue;break;case 3:if(k!=="checkbox"&&k!=="radio"&&d===null)continue}h=g(o.n,!0);e=o.v;try{b=new RegExp(h.replace(/\/\*.*?\*\/\s*/g,"")||".","im")}catch(ii){b=/^\b$/}switch(o.t){case 2:if(ft(u))if(u.nodeName==="SELECT")if(it=function(){var n=u.id&&u.nextElementSibling;n&&n.id===u.id+"-button"&&n.children[1]&&n.children[1].className==="ui-selectmenu-text"&&(n.children[1].textContent=u[u.selectedIndex].text);fire(u,["input"]);log(f,u);++w},u.dispatchEvent(new Event("focus")),e=g(e).trim().toLowerCase(),e==="?")u.selectedIndex=R(0,u.options.length-1),it();else if(/^([01]?!|)$/.test(e)){for(s=0;s<u.length;++s)switch(e==="!"||e==="1!"){case!0:u[s].selected||(u[s].selected=!0);break;case!1:u[s].selected&&(u[s].selected=!1)}it()}else if(isNaN(e)){if(u.multiple){for(/[^\d ]/.test(e)||(e=e.replace(/ +/g,"|")),/[^\d |]/.test(e)||(e=e.replace(/ +/g,"")),v=/^[\d+](\|\d+)*$/.test(e)?e.split("|"):e.match(/(?<!\\)".*?(?<!\\)"/g),et=!1,v===null&&(v=['"'+e+'"']),s=0;s<u.length;++s)at='"'+u[s].value.toLowerCase().replace(/"/g,'\\"')+'"',vt='"'+u[s].text.toLowerCase().replace(/"/g,'\\"')+'"',u[s].selected?v.indexOf(s+"")<0&&v.indexOf(at)<0&&v.indexOf(vt)<0&&(u[s].selected=!1,et=!0):(v.indexOf(s+"")>-1||v.indexOf(at)>-1||v.indexOf(vt)>-1)&&(u[s].selected=!0,et=!0);et&&it()}else if(e=e.replace(/(?<!\\)"/g,""),e=e.replace(/\\"/g,'"'),u.value.toLowerCase()!==e)for(s=0;s<u.length;++s)if(e===u[s].value.toLowerCase()||e===u[s].text.toLowerCase()){u[s].selected=!0;it();break}}else u.selectedIndex!=e&&(u.selectedIndex=+e,u.selectedIndex==e&&it());else ut!==null&&(u.afLI=getParent(u,'[role="listitem"]'),u.afRule=f,u.afValue=e,u.afTick=0,u.timer=setInterval(function(n){n.afLI&&!bOpen&&(bOpen=!0,n.click(),clearInterval(n.timer),n.timer=setInterval(function(n){ot=n.afLI.querySelectorAll('[data-value="'+n.afValue+'"]')[1];ot&&(ot.click(),bOpen=!1,log(n.afRule,n),updateStatus(0,1));(ot||++n.afTick==100)&&clearInterval(n.timer)},50,n));++n.afTick==100&&clearInterval(n.timer)},50,u));break;case 3:if(ft(u))if(y=g(e).replace(/\s+/g,""),y==="?")switch(u.type){case"checkbox":w+=toggle(u,R(0,1),f,d);break;case"radio":h=h.replace(/[\^\$]/g,"");dt.indexOf("["+h+"]")<0&&(yt=queryBySelector("input[type=radio]"+(h?'[name="'+escapeStr(h)+'"]':"")),w+=toggle(yt[R(0,yt.length-1)],1,f,d),dt.push("["+h+"]"))}else y.length>1&&y.indexOf("!")<0?(nt[h]===undefined?nt[h]=0:++nt[h],nt[h]<y.length&&toggle(u,+y.charAt(nt[h]),f,d),y.length===nt[h]+1&&++w):w+=toggle(u,parseInt(y),f,d);break;case 4:tt===undefined&&(tt={});tt[f]=g(e);break;default:if(u.nodeName==="INPUT"||u.nodeName==="TEXTAREA"){if(oLS.other.skiphidden&&u.offsetParent===null)continue;(o.o||!u.value)&&ft(u)&&(lt(u,g(e),f),oLS.other.vars&&e.indexOf("{")>-1&&(ht[f]=u.value))}else{if(st=u.nodeName==="IFRAME",!st&&!u.isContentEditable||st&&!validIframe(u)||!ft(u))continue;if(u.done===undefined){if(u.afMode!==undefined)continue;u.afMode=o.o;u.afRule=f;u.afValue=g(e);u.addEventListener("done",function(){var n=this.nodeName==="IFRAME"?this.contentDocument.body:this;(this.afMode||!cleanHtml(n.innerHTML))&&(lt(n,this.afValue,this.afRule),t||(D.autofilled=performance.now(),updateStatus(0,1)))},{once:!0})}else pt=st?u.contentDocument.body:u,(o.o||!cleanHtml(pt.innerHTML))&&lt(pt,g(e),f)}}}}if(!t){if(D.autofilled=performance.now(),delete D.autofilling,tt&&!i&&(D.readyState==="complete"?w+=executeJs(tt):window.addEventListener("load",function(n){return function(){updateStatus(0,executeJs(n))}}(tt))),!r)for(f in a)wt=oAdvanced[f]&&oAdvanced[f].delay||oAdvanced[a[f].c]&&oAdvanced[a[f].c].delay||0,wt&&(bt={},bt[f]=a[f],setTimeout(function(n){Autofill(null,null,null,n)},wt*1e3,bt));p.length&&chrome.storage.local.get("rules",function(n){var i,t;if(!chrome.runtime.lastError){for(i=JSON.parse(n.rules),t=0;t<p.length;++t)i[p[t].key]=p[t].obj;chrome.storage.local.set({rules:JSON.stringify(i)})}});updateStatus(gt,w)}}}}function addRule(n){if(!elET)return[];var t,i;if(getLabels(),isGForms(elET)?t=getGFLabel(elET):isMOForms(elET)&&(t=getMOFLabel(elET)),t||(t=getName(elET)),elET.type!==undefined)i=elET.value;else if(elET.isContentEditable)i=getHtml(elET.innerHTML);else if(elET.nodeName==="IFRAME"&&(i=getIframe(elET),typeof i!="string"))return[];return t&&i!==elET.initialValue?[{t:elET.type==="password"?1:0,n:t,v:i,s:sSite,c:n}]:[]}function addRules(n,t){var e,r,f,h=":not([disabled]):not([hidden]):not([readonly])",o=[],v=queryBySelector(sInputs+h,t),y=queryBySelector("select"+h,t),p=queryBySelector("textarea"+h,t),w=queryBySelector("[contenteditable=true]",t),b=queryBySelector("iframe",t),k=queryBySelector("div[jsaction][aria-selected=true]",t),d=queryBySelector("div[jsaction][aria-checked=true]",t),l,a,u,i;for(getLabels(),u=0;u<v.length;++u)if((i=v[u],r="",e=i.type,f=i.value,(e!=="file"||f)&&e!=="hidden"&&i.parentNode.id.indexOf("autofill-")!==0)&&(e!=="password"&&e!=="checkbox"&&e!=="radio"&&(e="text"),i.id==="m"&&console.log(i.checked,i.initialValue),(e!=="text"&&e!=="password"||f!==i.initialValue)&&(e!=="checkbox"&&e!=="radio"||i.checked!==i.initialValue))){isGForms(i)?r=getGFLabel(i):isMOForms(i)&&(r=getMOFLabel(i));r||(r=getName(i));switch(e){case"text":r&&o.push({t:0,n:r,v:f,s:sSite,c:n});break;case"password":o.push({t:1,n:r,v:f,s:sSite,c:n});break;default:(e==="checkbox"||e==="radio")&&o.push({t:3,n:r,v:new RegExp(r).test(i.name)?getChecked(i):+i.checked+"",s:sSite,c:n})}}for(u=0;u<y.length;++u)if((i=y[u],(i.multiple?getSelOptions(i):i.value)!==i.initialValue&&i.parentNode.id.indexOf("autofill-")!==0)&&(r=getName(i),r)){if(i.multiple){f="";for(var s=0,c=i.length,g=0;s<c;++s)i[s].selected&&(f+='|"'+(i[s].value||i[s].text).replace(/"/g,'\\"')+'"',++g),s===c-1&&g===c&&(f="1!");f=f.slice(1)}else f='"'+(i.value||i.text).replace(/"/g,'\\"')+'"';o.push({t:2,n:r,v:f,s:sSite,c:n})}for(u=0;u<p.length;++u)(i=p[u],r="",f=i.value,f!==i.initialValue&&i.offsetParent!==null)&&(isMOForms(i)&&(r=getMOFLabel(i)),r||(r=getName(i)),r&&o.push({t:0,n:r,v:f,s:sSite,c:n}));for(u=0;u<w.length;++u)(i=w[u],f=getHtml(i.innerHTML),f!==i.initialValue)&&(r=getName(i),r&&o.push({t:0,n:r,v:f,s:sSite,c:n}));for(u=0;u<b.length;++u)if(i=b[u],f=getIframe(i),f instanceof Array)l=addRules(n,i.contentDocument),l.length&&(o=o.concat(l));else{if(f===undefined||f===i.initialValue)continue;r=getName(i);r&&(oLS.other.sitefilters&&self!==top&&top.origin.indexOf(sHost)>-1&&(a=getCommonPath(sSite,top.location.hostname.replace(/^www\d*?\./,"")+top.location.pathname),a&&(sSite=escapeRegex(a))),o.push({t:0,n:r,v:f,s:sSite,c:n}))}for(u=0;u<k.length;++u)(i=k[u],f=(i.getAttribute("data-value")||"").trim(),f&&f!==i.parentNode.initialValue&&!i.classList.contains("isPlaceholder"))&&(r=getGFLabel(i)||getName(i),r&&o.push({t:2,n:r,v:f,s:sSite,c:n}));for(u=0;u<d.length;++u)i=d[u],r=getName(i),r&&o.push({t:3,n:r,v:"1",s:sSite,c:n});return o}function backupField(n){var i,f,e,r,u,t;if(oLS.other.backup&&n.inputType&&(elET=n.target.matches(sFields)?n.target:n.target.ownerDocument.defaultView.frameElement,elET)&&(i=elET.contentDocument,f=i&&i.body?getHtml(i.body.innerHTML):elET.value||getHtml(elET.innerHTML),!(f.length<oLS.backup))){for(r=sBackup+sHost,u=!0,t=0;t<oLS.cats.length;++t)if(oLS.cats[t].n===r){e=oLS.cats[t].k;u=!1;break}u?sendMessage({type:"saveCat",data:{backup:!0,cat:{n:r,s:sSite}}},function(n){saveRule(n.cat)}):saveRule(e)}}function cleanHtml(n){return n.replace(/\s|<.+?>|&nbsp;/gi,"")}function clearHighlight(){elHighlighted&&(elHighlighted.initialStyle?elHighlighted.setAttribute("style",elHighlighted.initialStyle):elHighlighted.removeAttribute("style"),delete elHighlighted.initialStyle)}function createObserver(n){n.observer||(n.observer=new MutationObserver(function(n){n.forEach(function(n){for(var r,t,i=[],u=0;u<n.addedNodes.length;++u)if(t=n.addedNodes[u],t.nodeType===1&&t.id!=="autofill-wizard"&&!/HEAD|LINK|SCRIPT|STYLE|TITLE/.test(t.nodeName)&&(t.nodeName!=="IFRAME"||validIframe(t)))if(t.children&&t.children.length)for(i=queryBySelector(sFillable,t),r=0;r<i.length;++r)(i[r].initialValue!==undefined||aFO.indexOf(i[r])>-1)&&i.splice(r,1);else t.matches(sFillable)&&aFO.indexOf(t)<0&&i.push(t);i.length&&(updateStatus(i.length,0),initFields(i),aFO=aFO.concat(i),Autofill(i,!0,!0),D.autofilling&&!bManual&&Autofill(i,!1,!0))})}),n.observer.observe(n.body||n,{childList:!0,subtree:!0}))}function debounce(n){var t;return function(){var i=this,r=arguments,u=function(){n.apply(i,r)};clearTimeout(t);t=setTimeout(u,50)}}function escapeClass(n){var t=n.replace(/[\r\n]+/g," ").trim().replace(/ +/g,".").replace(/([^\w.,>~#+-])/g,"\\$1").replace(/\b(\d+)\.(\d+)\b/g,"$1\\.$2");return t?"."+t:null}function escapeRegex(n){return n.replace(/([$^?+*\\|(){}\[\]])/g,"\\$1")}function escapeStr(n){return n.replace(/("|\\)/g,"\\$1").replace(/[\r\n]+/g," ")}function executeJs(n){var i=0;for(var t in n)try{eval(n[t]);log(t,n[t]);++i}catch(r){bDebug&&console.warn("["+sExtName+"] The following JavaScript code was not executed:\n\n"+n[t]+"\n\nError: "+r.message+"\nFrame: "+D.URL)}return i}function fire(n,t,i){if(!n.isContentEditable){if(n.value===undefined)return;t.push("change")}i=i||n.classList.contains("wym_iframe");for(var r=0;r<t.length;++r)n.dispatchEvent(new Event(t[r],{bubbles:!i}));D.activeElement.blur()}function getCartesian(n){if(!(n[0]instanceof Array))return[];var t=[],i=function(r,u){for(var e,f=0;f<n[u].length;++f)e=r.slice(0),e.push(n[u][f]),u===n.length-1?t.push(e):i(e,u+1)};return i([],0),t}function getCatId(n){return n>2?oLS.cats[n-5].k:n===1?"all":""}function getChecked(n){var i,r,t;if(!n.name)return"";for(i=D.getElementsByName(n.name),r="",t=0;t<i.length;++t)r+=+i[t].checked+"";return r}function getCombinations(n){var t=function(n,i,r){return n.length===0&&i.length===0?[]:(i.length===0?r.push(n):(t(n.concat(i[0]),i.slice(1),r),t(n,i.slice(1),r)),r.sort(function(n,t){return n.length-t.length}))};return t([],n,[])}function getCommonPath(n,t){while(n.indexOf(t)===-1||t.slice(-1)!=="/")t=t.slice(0,-1);return t}function getGFLabel(n){var u,t=getParent(n,"[role=listitem]"),i,r;return t&&t.querySelectorAll("input,[aria-selected=true]").length===1&&(i=t.querySelector("[role=heading]"),i&&(r=i.textContent.trim(),uniqueArrVal(aFormLabels,r)&&(u="^"+escapeRegex(r)+"$"))),u}function getHtml(n){return n=n.replace(/<script.+?<\/script>/gi,""),cleanHtml(n)?n.trim():""}function getIframe(n){if(!validIframe(n))return undefined;try{var t=n.contentDocument,i=t&&t.body&&queryBySelector(sFields,t.body);return i&&i.length?i:t&&t.body?getHtml(t.body.innerHTML):(createObserver(t),undefined)}catch(r){return undefined}}function getLabels(){aFormLabels=[];D.querySelectorAll("[role=heading].freebirdFormviewerComponentsQuestionBaseTitle,.office-form-question-title .text-format-content").forEach(function(n){aFormLabels.push(n.textContent.trim())})}function getMOFLabel(n){var r,u=getParent(n,".office-form-question-content"),t,i;return u&&(t=u.querySelector(".text-format-content"),t&&(i=t.textContent.trim(),uniqueArrVal(aFormLabels,i)&&(r="^"+escapeRegex(i)+"$"))),r}function getName(n){var t="^"+escapeRegex(getUniqueAttr(n,"aria-label")||((n.type==="checkbox"||n.type==="radio")&&n.value!==undefined?getUniqueAttr(n,"value"):"")||n.name||n.id||getUniqueAttr(n,"aria-labelledby")||getUniqueAttr(n,"aria-describedby")||getUniqueAttr(n,"data-bind")||getUniqueAttr(n,"data-reactid")||getUniqueAttr(n,"ng-model")||getUniqueAttr(n,"title")||getUniqueAttr(n,"placeholder")||(n.src&&n.src.indexOf(location.origin)===0&&n.src!==D.URL?n.src:"")||"").trim()+"$",i=[];if(t==="^$"){t=(n.initialClass||n.className||"").trim();try{i=D.querySelectorAll(escapeClass(t))}catch(r){bDebug&&console.warn("["+sExtName+"] "+r)}t=t&&t.indexOf("quantumWizMenuPaperselectOption")<0&&i.length===1?"\\b"+t+"\\b":getUniqueSelector(n)}return t}function getParent(n,t){if(t&&typeof t=="string"){while(n=n.parentElement)if(n.matches(t))return n;return null}return n.parentElement}function getSelOptions(n){for(var r=[],i=n.selectedOptions||[],t=0;t<i.length;++t)r.push(i[t].value||i[t].text);return JSON.stringify(r)}function getUniqueAttr(n,t){var i=n.getAttribute(t),r;return i&&(r=D.querySelectorAll("["+t+'="'+escapeStr(i)+'"]').length,self!==top&&top.origin.indexOf(sHost)>-1&&(r+=top.document.querySelectorAll("["+t+'="'+escapeStr(i)+'"]').length)),r===1?i:undefined}function getUniqueSelector(n){if(n instanceof Element){for(var e=n,i,t=[],r,u=function(n,i){var s,o=n.nodeName.toLowerCase(),e,v,p,a,y,c,h,l,u;for(t.unshift([]),n.id&&t[0].push("#"+n.id),t.length>1&&t[0].push(o),n.hasAttribute("aria-label")&&n.hasAttribute("aria-describedby")&&(s='[aria-label="'+escapeStr(n.getAttribute("aria-label"))+'"][aria-describedby="'+escapeStr(n.getAttribute("aria-describedby"))+'"]',t[0].push(s,o+s)),e=n.className.replace(/\bis(Checked|Selected)\b/g,"").trim(),e&&(e=escapeClass(e),t[0].push(e,o+e)),v=getCombinations(n.getAttributeNames().filter(function(n){return n!=="id"&&n!=="class"&&!/[^\w-]/.test(n)})),u=0;u<v.length;++u)for(y=0;y<v[u].length;++y)p=v[u][y],a=n.getAttribute(p),a.indexOf("\n")>-1&&(a=""),s="["+p+(a?'="'+escapeStr(a)+'"':"")+"]",t[0].push(s,o+s),e&&t[0].push(s+e,o+s+e);if(i){for(c=n,h=1;c=c.previousElementSibling;)c.nodeName===n.nodeName&&++h;for(l=":nth-of-type("+h+")",t[0].push(o+l),e&&t[0].push(o+e+l),c=n,h=1;c=c.previousElementSibling;)++h;l=h>1?h===n.parentElement.children.length?":last-child":":nth-child("+h+")":":first-child";t[0].push(o+l);e&&t[0].push(o+e+l)}if(t.length===1){for(u=0;u<t[0].length;++u)if(f([t[0][u]]))return[t[0][u]]}else{for(u=0;u<t.length;++u)if(t[u].length>500)return;for(r=getCartesian(t),u=0;u<r.length;++u)if(f(r[u]))return r[u]}return},f=function(n){var t=[];try{t=D.querySelectorAll(n.join(">")||null)}catch(i){bDebug&&console.warn("["+sExtName+"] "+i)}return t.length===1};n.parentElement;){if(i=u(n),i)return escapeRegex(i.join(" > "));if(n=n.parentElement,n===D.body)break}for(n=e,t=[];n.parentElement;){if(i=u(n,!0),i)return escapeRegex(i.join(" > "));if(n=n.parentElement,n===D.body)break}return""}}function getVar(n){var r,i,t,u;if(oLS.variables.length&&(reVar=/\{@(\w+)\}/g).test(n))for(aMatches=n.match(reVar),r=0;r<aMatches.length;++r)for(i=0;i<oLS.variables.length;++i)if(oLS.variables[i][0]!=="#"){if(t=oLS.variables[i].match(/^(\w+) = (.+)$/),t)t=t.slice(1);else continue;if(aMatches[r]==="{@"+t[0]+"}"){if(reVar=new RegExp("{@"+t[0]+"}","g"),u="",t[1].indexOf("javascript:")>-1)try{u=eval(t[1].replace("javascript:",""))}catch(f){}else u=t[1].replace(/\\=/g,"=").replace(/\\n/g,"\n");n=n.replace(reVar,u);break}}return n}function highlightField(n){if(n.getAttribute(sHighlight)!=="false"){var t;if(!n.type)if(n.nodeName==="IFRAME")validIframe(n)?(t=n.contentDocument,n=t&&t.activeElement||null):n=null,n&&!n.matches(sFields)&&(n=n.ownerDocument.defaultView.frameElement||null);else while(n){if(n.nodeName==="BODY"||n.getAttribute("contenteditable")==="true")break;n=n.parentNode}return n&&(elHighlighted=n.nodeName==="IFRAME"?t&&t.body:n,elHighlighted&&elHighlighted.initialStyle===undefined&&(elHighlighted.initialStyle=elHighlighted.getAttribute("style"),setTimeout(function(){elHighlighted.setAttribute("style","background:#cadbf2!important")},0))),n}}function injectJquery(){return new Promise(function(n,t){try{chrome.runtime.sendMessage({type:"injectJquery"},function(){window.$&&(bDebug&&console.log("["+sExtName+"] jQuery v"+$().jquery+" loaded."),n())})}catch(i){t(i)}})}function log(n,t){if(bDebug){var i="["+sExtName+"] Rule "+n.replace("r","n")+' in profile "'+(oCats[oLS.rules[n].c]?oCats[oLS.rules[n].c].n:"Unfiled")+'"';typeof t=="string"?console.log(i+" executed this JavaScript:\n\n"+t+"\n\n"):console.log(i+" autofilled this field:",t)}}function queryBySelector(n,t){return[].slice.call((t||D).querySelectorAll(n))}function R(n,t){return Math.floor(Math.random()*(t-n+1)+n)}function saveRule(n){var t=addRule(n);t.length&&(sendMessage({type:"saveRules",data:{backup:!0,rules:t}}),elET=undefined)}function sendMessage(n,t,i){try{chrome.runtime.sendMessage(n,typeof t=="function"?t:function(){chrome.runtime.lastError})}catch(r){(!i||i.type!=="beforeunload")&&D.getElementById("autofill-wizard")&&alert(sBgUpdErr)}}function toggle(n,t,i,r){var f=0,u;if(typeof n.checked=="boolean")u=n.checked;else if(r!==null)u=r==="true"?!0:!1;else return 0;switch(t){case 0:u&&(n.click(),log(i,n),++f);break;case 1:u||(n.click(),log(i,n),++f)}return f}function updateStatus(n,t){sendMessage({type:"updateStatus",data:{fields:n,filled:t}})}function validIframe(n){try{return n.offsetParent&&n.clientWidth>1&&n.clientHeight>1&&(!n.src||n.src.indexOf(location.origin)===0||/^(about|javascript)/i.test(n.src))&&(!n.contentDocument||!n.contentDocument.querySelector(sInputs+",select,iframe"))}catch(t){return!1}}function uniqueArrVal(n,t){return n.filter(function(n){return n===t}).length===1}function handleBeforeunload(n){sendMessage({type:"resetCounters",data:{force:!0}},null,n)}function handleIframeBlur(){this.setAttribute(sHighlight,"false")}function handleIframeFocus(){this.setAttribute(sHighlight,"true")}function handleMessage(n,t,i){var u,f,r,e;switch(n.type){case"autofill":bException?bDebug&&console.warn("["+sExtName+"] Autofilling is disabled for this page because it is on the Exceptions list."):oLS&&(u=function(){bActiveCat=!0;bManual=!0;oForceFill=undefined;sCatCurrent=getCatId(n.catnow);Autofill()},n.catnow===oLS.catnow?u():D.addEventListener("init",u,{once:!0}));break;case"clearHighlight":clearHighlight();break;case"create":f=elET?addRule(n.cat):elET===null?[]:addRules(n.cat);f.length&&sendMessage({type:"appendRules",data:f});i({field:!!elET});break;case"insertText":if(r=D.activeElement,r.nodeName==="BODY"||r.nodeName==="IFRAME")return;chrome.storage.local.get("textclips",function(t){var u,i;if(!chrome.runtime.lastError)for(u=t.textclips,i=0;i<u.length;++i)if(n.id===u[i].trim().split("\n")[0].replace(/ *> *|\W/g,"_").toLowerCase()){if(u[i]=u[i].replace(/\r?\n/g,"\n").replace(/\s*.+\n/,""),r.isContentEditable){var e=D.createElement("span"),o=getSelection(),f=o.getRangeAt(0);f.deleteContents();e.innerHTML=u[i].replace(/\n/g,"<br>");f.insertNode(e);f.collapse(!1);f.setEnd(r,2)}else r.value=r.value.slice(0,r.selectionStart)+u[i]+r.value.slice(r.selectionEnd);break}});break;case"showWizard":clearHighlight();elET=n.data.editable?(self===top&&!n.data.frame||n.data.frame)&&D.activeElement.matches(sFillable)?highlightField(D.activeElement):null:undefined;oLS.editable=n.data.editable;oLS.wiztype=n.data.type;D.getElementById("autofill-wizard")?(Wizard.updateText(),i({css:!!D.autofillCssInjected,open:!0})):self===top&&(i({css:!!D.autofillCssInjected,open:!1}),D.autofillCssInjected=!0);break;case"sync":if(!oLS)return;e=oLS.other.backup;init().then(function(){oLS.other.backup!==e&&initFields(queryBySelector(sFillable),!0)},function(n){var t="["+sExtName+"] "+n;oLS?bDebug&&console.warn(t):console.error(t)})}}var D=document,sExtName=chrome.runtime.getManifest().name,sBackup="Backup - ",sBgUpdErr=sExtName+" "+chrome.i18n.getMessage("wizardUpdateAlert"),sInputs="input:not([type=button]):not([type=image]):not([type=reset]):not([type=submit])",sFields=sInputs+",select,textarea,[contenteditable=true]",sFillable=sFields+",iframe,div[jsaction][aria-checked],div[jsaction][aria-selected]",sHighlight="data-autofill-highlight",sHost=location.host?location.hostname.replace(/^www\d*?\./,""):location.pathname.replace(/^.+?(\/)(.+\/)?.+$/,"$1$2"),sSite="",sSiteHaystack=D.title+"\n"+D.URL+(D.URL.indexOf("http")===0?"\n"+D.URL.replace(/(:\/\/)(www\d*?\.)?/,D.URL.indexOf("://www")<0?"$1www.":"$1"):""),sUrl=window.location!==window.parent.location?D.referrer:D.location.href,aFO=[],aFormLabels,sCatCurrent,oAdvanced,oCats,oForceFill,oLS,elET,elHighlighted,bActiveCat,bDebug,bException,bManual,bOpen=!1,mInitial=new Map,isGForms=function(n){return n.classList.contains("quantumWizTextinputPaperinputInput")||n.classList.contains("quantumWizMenuPaperselectOption")},isMOForms=function(n){return n.classList.contains("office-form-question-textbox")},isZendesk=D.querySelectorAll("form#new_request[data-form-type=request]").length===1,handleKeyDown=debounce(function(n){var i,u,t,r;if(oLS)for(i=0;i<oLS.cats.length;++i)if(oLS.cats[i].h){for(t=!0,u=oLS.cats[i].h.split(" + "),r=0;r<u.length;++r)switch(u[r]){case"Ctrl":n.ctrlKey||(t=!1);break;case"Shift":n.shiftKey||(t=!1);break;case"Alt":n.altKey||(t=!1);break;case"Option":n.altKey||(t=!1);break;case"Win":n.metaKey||(t=!1);break;case"⌘":n.metaKey||(t=!1);break;default:u[r].replace(/ /g,"").replace(/^Space$/," ").toUpperCase()!==(n.key||"").toUpperCase()&&(t=!1)}if(t){sendMessage({type:"executeRules",data:{catnow:i+5}});return}}});sUrl&&window.innerWidth>1&&window.innerHeight>1&&(init().then(function(){var t=queryBySelector(sFillable),n=oLS.other.delay?oLS.delay:0;updateStatus(t.length,0);initFields(t);D.body.hasAttribute("jsaction")&&D.body.className.indexOf("freebird")>-1&&n<.5&&(n=.5);setTimeout(function(){Autofill(null,!0)},250);bManual||(n?setTimeout(Autofill,n*1e3):Autofill(t));createObserver(D)},function(n){var t="["+sExtName+"] "+n;oLS?bDebug&&console.warn(t):console.error(t)}),chrome.runtime.onMessage.addListener(handleMessage),self===top&&window.addEventListener("beforeunload",handleBeforeunload));
