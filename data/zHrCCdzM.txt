#!/usr/bin/env python3
# version = 20221120

import telebot
import time
import urllib
import os
import requests

url='http://192.168.0.129:8080/?action=snapshot'
tb = telebot.TeleBot("TOKEN")
host = 'http://192.169.0.129'

def url_checker(host):
	try:
		#Get Url
		get = requests.get(host)
		# if the request succeeds 
		if get.status_code == 200:
			#return(f"{host}: is reachable")
			return True
		else:
			#return(f"{host}: is Not reachable, status_code: {get.status_code}")
			return False
	#Exception
	except requests.exceptions.RequestException as e:
        # print URL with Errs
		raise SystemExit(f"{host}: is Not reachable \nErr: {e}")


@tb.message_handler(commands=['photo'])
def send_photo(message):
    if os.path.exists("out.jpg"):
     os.remove("out.jpg")

    f = open('out.jpg','wb')
    f.write(urllib.request.urlopen(url).read())
    f.close()

    tb.send_chat_action(message.chat.id, 'upload_photo')
    img = open('out.jpg', 'rb')
    tb.send_photo(message.chat.id, img, reply_to_message_id=message.message_id)
    img.close()

tb.polling()

while True:
    time.sleep(0)