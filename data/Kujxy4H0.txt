from kivy.app import App
from kivy.lang import Builder
from kivy.uix.screenmanager import Screen
from kivy.uix.button import Button

kv = """
<PageButton>:
    on_release: self.go_to_page(self.text)

<TableOfContentsScreen>:
    GridLayout:
        id: grid
        rows: 4
        cols: 4

<ContentScreen>:
    BoxLayout:
        orientation: 'vertical'
        Label:
            id: label
        Button:
            size_hint_y: None
            height: dp(48)
            text: 'Home'
            on_release: app.root.ids.sm.current = 'toc'
    
BoxLayout:
    orientation: 'vertical'
    Label:
        size_hint_y: None
        height: dp(30)
        text: 'Hymn Example'
    ScreenManager:
        id: sm
        TableOfContentsScreen:
            name: 'toc'
        ContentScreen:
            name: 'contents'

"""


class PageButton(Button):
    hymns = {'Hymn 1': {'text': 'hymn_00.txt', 'audio': 'hymn_00.mp3'},
             'Hymn 2': {'text': 'hymn_01.txt', 'audio': 'hymn_01.mp3'},
             'Hymn 3': {'text': 'hymn_02.txt', 'audio': 'hymn_02.mp3'},
             'Hymn 4': {'text': 'hymn_03.txt', 'audio': 'hymn_03.mp3'},
             'Hymn 5': {'text': 'hymn_04.txt', 'audio': 'hymn_04.mp3'},
             'Hymn 6': {'text': 'hymn_05.txt', 'audio': 'hymn_05.mp3'},
             'Hymn 7': {'text': 'hymn_06.txt', 'audio': 'hymn_06.mp3'},
             'Hymn 8': {'text': 'hymn_07.txt', 'audio': 'hymn_07.mp3'},
             'Hymn 9': {'text': 'hymn_08.txt', 'audio': 'hymn_08.mp3'},
             'Hymn 10': {'text': 'hymn_09.txt', 'audio': 'hymn_09.mp3'},
             'Hymn 11': {'text': 'hymn_10.txt', 'audio': 'hymn_10.mp3'},
             'Hymn 12': {'text': 'hymn_11.txt', 'audio': 'hymn_11.mp3'},
             'Hymn 13': {'text': 'hymn_12.txt', 'audio': 'hymn_12.mp3'},
             'Hymn 14': {'text': 'hymn_13.txt', 'audio': 'hymn_13.mp3'},
             'Hymn 15': {'text': 'hymn_14.txt', 'audio': 'hymn_14.mp3'},
             'Hymn 16': {'text': 'hymn_15.txt', 'audio': 'hymn_15.mp3'}}

    def get_hymn_text(self, page):
        with open(self.hymns[page]['text']) as f:
            return f.read()

    def go_to_page(self, page):
        app = App.get_running_app()
        sm = app.root.ids.sm
        sm.get_screen('contents').ids.label.text = self.get_hymn_text(page)
        sm.current = 'contents'


class TableOfContentsScreen(Screen):
    def on_kv_post(self, base_widget):
        grid = self.ids.grid
        for i in range(1, 17):
            grid.add_widget(PageButton(text=f'Hymn {i}'))


class ContentScreen(Screen):
    pass


class HymnApp(App):
    def build(self):
        return Builder.load_string(kv)

    def on_start(self):
        # this is here ONLY to create test files... remove after files are created.
        for i in range(16):
            with open(f'hymn_{i:02d}.txt', 'w') as f:
                f.write(f'This is the content of file Hymn_{i:02d}.txt')


HymnApp().run()
