Write script that check for connections of NetworkManager on arch linux and sends notification if it connected to new network and triggers via dbus messages

#!/bin/bash

# Check for NetworkManager DBus connection
if ! systemctl status NetworkManager.service | grep -q "active (running)"
then
  echo "NetworkManager is not running. Exiting."
  exit 1
fi

# Monitor NetworkManager for new connections
dbus-monitor --system "type='signal',interface='org.freedesktop.NetworkManager'" | \
while read -r line ; do
  # Check for new connection 
  if echo "${line}" | grep -q "State = activated" ; then
    # Extract SSID name
    ssid=$(echo "${line}" | grep SSID | sed -r 's/^.*SSID = //;s/[",]//g;s/^[ \t]*//;s/[ \t]*$//')
    # Print the notification
    notify-send "NetworkManager" "Connected to '${ssid}'"
  fi
done

exit 0