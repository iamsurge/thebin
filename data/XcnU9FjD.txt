script:
  notification_android:
    alias: Android notifikationer
    icon: mdi:android-debug-bridge
    description: Med dette script er det nemt at sende notifikationer til en Android enhed.
    fields:
      service:
        name: Service
        description: Hvilken telefon skal der sendes til
        required: true
        example: notify.mobile_app_redmi_9t
        default: notify.mobile_app_redmi_9t
        selector:
          text:
            type: text

      title:
        name: Titel
        description: Titel på notifikationen
        example: Alarm
        selector:
          text:
            type: text

      message:
        name: Besked
        description: Besked
        required: true
        example: Dette er en meget vigtig besked
        selector:
          text:
            type: text
            multiline: true

      notification_icon:
        name: Beskedens ikon
        description: Ikon til statusbjælken
        example: mdi:cellphone
        selector:
          text:
            type: text

      icon_url:
        name: Ikon
        description: URL til et ikon
        example: https://github.com/home-assistant/assets/blob/master/logo/logo-small.png?raw=true
        selector:
          text:
            type: url

      group:
        name: Gruppe
        description: Gruppenavn såfremt flere beskeder skal samles
        example: Nogen er kommet hjem
        selector:
          text:
            type: text

      channel:
        name: Kanal
        description: Hvilke kanal, med speciel ringetone, skal beskeden sendes til
        example: Motion
        selector:
          text:
            type: text

      remove_channel:
        name: Fjern kanal
        description: Ryd op i tidligere beskeder og fjern en kanal
        example: Motion
        selector:
          text:
            type: text

      importance:
        name: Vigtighed
        description: Kanalens vigtighed
        example: high
        selector:
          select:
            mode: dropdown
            options:
              - label: Maximum
                value: Max
              - label: Høj
                value: high
              - label: Lav
                value: low
              - label: Minimum
                value: min
              - label: Standard
                value: default

      alert_once:
        name: Kun 1 alarm
        description: Send kun én alarm. OBS kræver tag
        selector:
          boolean:

      persistent:
        name: Vedholdende
        description: Vedholdende besked som ikke kan swipes væk. OBS kræver tag
        selector:
          boolean:

      tag:
        name: Tag
        description: Det <tag> som beskeden skal mærkes med
        example: postkasse
        selector:
          text:
            type: text

      clear_notification:
        name: Ryd
        description: Ryd en tidligere besked. OBS, kræver tag
        default: false
        selector:
          boolean:

      sticky:
        name: Sticky
        description: Skal beskeden blive hængende
        selector:
          boolean:

      timeout:
        name: Timeout
        description: Tid, i sekunder, hvorefter beskeden fjernes
        example: 300
        selector:
          text:
            type: number

      visibility:
        name: Synlighed
        description: Skal beskedena indhold være synlig på låseskærmen
        selector:
          select:
            mode: dropdown
            options:
              - label: Vis
                value: public
              - label: Afhænger af telefonens indstilling
                value: private
              - label: Skjul
                value: secret

      tts_text:
        name: Text til tale (TTS))
        description: Skal beskeden læses op
        default: false
        selector:
          boolean:

      chronometer:
        name: Tæller
        description: Skal vi starte en tæller? OBS, værdi skal angives
        selector:
          boolean:

      when:
        name: Tidsstempel
        description: Tidsstempel som der skal tælles op/ned til
        example: 1609459200
        selector:
          text:
            type: number

      image:
        name: Billede
        description: Vedhæft et billede fra en URL
        example: https://static1.gewaechshauscentrum.de/media/10789/allux-grundform-sort-struktur-mnavn.jpeg
        selector:
          text:
            type: text

      video:
        name: Video
        description: Vedhæft en video fra en URL
        selector:
          text:
            type: text

      audio:
        name: Lyd
        description: Vedhæft en lydfil fra en URL
        selector:
          text:
            type: text

      actions:
        name: Handlinger
        description: Liste over actions og title
        example: "- title: OK, posten er hentet\n  name: mailbox_reset\n- title: Jeg gør det senere\n  name: mailbox_later"
        selector:
          object:

    sequence:
      - variables:
          tts_text: "{{ message if tts_text and message else false}}"

          message: >-
            {% if clear_notification and tag %}
              clear_notification
            {% elif remove_channel and channel %}
              remove_channel
            {% elif tts_text and message %}
              TTS
            {% else %}
              {{ message }}
            {% endif %}

          importance: "{{ importance if importance and channel }}"

          persistent: >-
            {{ true if persistent and tag }}

      - service: "{{ service }}"
        data:
          title: "{{ title }}"
          message: |
            {{ message }}
          data:
            notification_icon: "{{ notification_icon }}"
            icon_url: "{{ icon_url }}"
            group: "{{ group }}"
            channel: "{{ channel }}"
            importance: "{{ importance }}"
            alert_once: "{{ alert_once }}"
            persistent: "{{ persistent }}"
            tag: "{{ tag }}"
            sticky: "'{{ sticky }}'"
            timeout: "{{ timeout }}"
            visibility: "{{ visibility }}"
            tts_text: "{{ tts_text }}"
            chronometer: "{{ chronometer }}"
            when: "{{ when }}"              
            image: "{{ image }}"
            video: "{{ video }}"
            audio: "{{ audio }}"
            actions: >-
              {% set ns = namespace(actions = []) %}
              {% for a in actions %}
                {% set ns.actions = ns.actions + [{'action': a.action, 'title': a.title}] %}
              {% endfor %}
              {{ ns.actions }}