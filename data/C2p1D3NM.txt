#include <sys/types.h>
#include <sys/stat.h>
#include <sys/wait.h>
#include <unistd.h>
#include <fcntl.h>
#include <stdio.h>
#include <stdlib.h>
#include <errno.h>
#include <string.h>
#define BUFFSIZE 4096 /* max. num. di caratteri in buf */

int main(int argc, char* argv[]){
pid_t pid;
int status;
int fd; int n;
char buffer[BUFFSIZE];
/* controlla i parametri input */
if (argc != 3)
printf("usage: trasfile <file> <stringa>"), exit(1);
/* genera il processo figlio */
if ( (pid = fork()) < 0)
perror("fork"), exit(1);/* errore di fork */
else if (pid == 0) { /* figlio */
/* apre il file da scrivere */
if ((fd = open(argv[1], O_WRONLY|O_CREAT|O_TRUNC, S_IRWXU))<0)
perror("create file error"), exit(1);
/* scrive la stringa */
if ((n = write(fd, argv[2], strlen(argv[2]))) < 0)
printf("write error"),exit(1);
/* chiude il file */
close(fd);
} else { /* padre */
/* attende la terminazione del figlio */ if
( (pid = waitpid(pid, &status, 0)) < 0)
perror("waitpid error"), exit(1);
/* apre il file */
if ((fd = open(argv[1], O_RDONLY, S_IRWXU)) < 0)
perror("open file error"), exit(1);
/* legge la stringa */
if ((n = read(fd, buffer, BUFFSIZE)) < 0)
printf("read error"),exit(1);
/* stampa la stringa */
printf("trovato: %s", buffer);
/* chiude il file */
close(fd);
} exit(0);}