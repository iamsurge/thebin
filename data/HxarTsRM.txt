## Magiskでのroot環境かSUが入ったGSIが必要になります

# 1. root権限で実行をする為にSU
su

# 2. 各イメージがあるパスへ移動(MediaTekなどでは /dev/block/by-name/ の場合もあります)
cd /dev/block/bootdevice/by-name/

# 3. バックアップ用ディレクトリを作成する
mkdir /sdcard/backup_img

# 4. cacheとuserdata以外すべてを/sdcardへバックアップのコマンドを実行
for file in *; do
    if [[ "${file}" = cache* || "${file}" = userdata* ]]; then continue ; else dd if=/dev/block/bootdevice/by-name/"${file}" of=/sdcard/backup_img/"${file}".img ; fi
done

# 5. MD5のチェック用リストを作成するコマンドを実行
echo "" > /sdcard/backup_img/md5.txt
for file in *; do
    if [[ "${file}" = cache* || "${file}" = userdata* ]]; then continue ; else
	echo "${file}" >> /sdcard/backup_img/md5.txt
	md5sum /dev/block/bootdevice/by-name/"${file}" >> /sdcard/backup_img/md5.txt
	md5sum /sdcard/backup_img/"${file}".img >> /sdcard/backup_img/md5.txt
	echo "" >> /sdcard/backup_img/md5.txt
    fi
done

# 6. fastbootでアクティブなスロットを確認(表示されているスロットが現在使用しているOSのimgになります)
fastboot getvar all