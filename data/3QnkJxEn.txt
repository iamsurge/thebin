#include <iostream>
#include <gst/gst.h>
#include <thread>
#include <chrono>

void mycb1() {
    std::cout << "mycb1\n";
}

void mycb2() {
    std::cout << "mycb2\n";
}

int main() {

    gst_init(nullptr, nullptr);
    auto *playbin = gst_parse_launch("videotestsrc ! autovideosink", nullptr);


    auto bus = gst_element_get_bus(playbin);
    gst_bus_set_sync_handler(bus, gst_bus_sync_signal_handler, nullptr, nullptr);


    g_signal_connect_data(bus, "sync-message::state-changed", G_CALLBACK(mycb1),
                          nullptr,
                          nullptr, {});
    

    g_signal_connect_data(bus, "sync-message::state-changed", G_CALLBACK(mycb2),
                          nullptr,
                          nullptr, {});


    gst_element_set_state(playbin, GST_STATE_PLAYING);
    std::this_thread::sleep_for(std::chrono::seconds(5));
    return 0;
}
