#!/bin/sh -v

# clear
# rm -rf test
# rm -rf test_upstream

# "upstream remote"
mkdir test_upstream
cd test_upstream
git init
touch somefile.txt
git add .
git commit -m "Upstream commit"
git tag "upstream_tag"
cd ..

mkdir test
cd test
git init
mkdir .gear
touch .gear/rules
touch test.spec
git remote add upstream ../test_upstream
git fetch upstream --tags

echo "tar: upstream_tag:." > .gear/rules
gear-store-tags --all

git add .
git commit -m "test"
git merge -s ours --allow-unrelated-histories upstream_tag -m "merge upstream"
git checkout upstream_tag
ls -a