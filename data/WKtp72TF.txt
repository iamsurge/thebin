#!/bin/bash
# twitch-stalker.sh
# Dependencies: yt-dlp binary in the same directory
# Watches a list of Twitch channels and immediately records their stream whenever they go live to archive them.
# Useful for channels that don't have VOD enabled
# Version 1.0
# NOV/21/2022
# Victor Coss gtaxl@gtaxl.net

####################################################################################################
############################# CONFIGURABLE OPTIONS #################################################
####################################################################################################
list="twitch-streamers.txt" # Text file listing the streamer's username(s) seperated by line breaks in linux format
check_interval="300" # How often to check if a channel is live, more aggressive may catch a stream earlier but hit API limits. Integer is in seconds, 300 is 5 minutes
####################################################################################################
############################# DON'T EDIT BELOW THIS LINE ###########################################
####################################################################################################

cat $list | while read user; do
	echo "user is $user" >> twitch_debug.txt
	./yt-dlp -q -F https://www.twitch.tv/$user &> twerr.tmp
	cat twerr.tmp | sed s/://g > twstatus.tmp
	$status=$(cat twstatus.tmp)
	rm twstatus.tmp
	echo "status is $status" >> twitch_debug.txt
	$exists=$(echo "$status" | grep "$user does not exist")
	echo "exists is $exists" >> twitch_debug.txt
	if [ -z "$exists" ]
	then
		echo "The user $user exists."
	else
		echo "The user $user DOES NOT exist."
	fi
done