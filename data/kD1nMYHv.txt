#!/bin/bash
# this file: go.sh
#
while read fname
do
./conv_log.sh $fname
done < ./log_read.txt

# -------------------------------
#!/bin/bash
# this file: conv_log.sh
#
logdate=$(cat log_read.txt |awk -F "/" '{print $6}' |awk -F "." '{print $1}')
logfile="$1"
tmpfile="/tmp/energyout.txt"
# if the logfile doesn't exist then bailout
if [ ! -f $logfile ]; then
   echo "Logfile doesn't exist, exiting..."
   exit 3
fi
#
cat $logfile |awk -F "," '{print $2}' > $tmpfile
#
# kwday=$(perl -nle' $s += $_; END { print $s*4/3600000 } ' $tmpfile)
kwday=$(perl -nle' $s += $_; END { printf "%.2f", $s*4/3600000 } ' $tmpfile)
#
echo "${logdate},${kwday}"
echo "${logdate},${kwday}" >> ./usage_log
#
rm -f $tmpfile
#
# input file (log_read.txt)
/usr/local/etc/energy_meter_logs/01-12-2021.log
/usr/local/etc/energy_meter_logs/02-12-2021.log
/usr/local/etc/energy_meter_logs/03-12-2021.log
/usr/local/etc/energy_meter_logs/04-12-2021.log
/usr/local/etc/energy_meter_logs/05-12-2021.log
/usr/local/etc/energy_meter_logs/06-12-2021.log
/usr/local/etc/energy_meter_logs/07-12-2021.log
/usr/local/etc/energy_meter_logs/08-12-2021.log
/usr/local/etc/energy_meter_logs/09-12-2021.log
/usr/local/etc/energy_meter_logs/10-12-2021.log
/usr/local/etc/energy_meter_logs/11-12-2021.log
/usr/local/etc/energy_meter_logs/12-12-2021.log
/usr/local/etc/energy_meter_logs/13-12-2021.log
/usr/local/etc/energy_meter_logs/14-12-2021.log
/usr/local/etc/energy_meter_logs/15-12-2021.log
/usr/local/etc/energy_meter_logs/16-12-2021.log
/usr/local/etc/energy_meter_logs/17-12-2021.log
/usr/local/etc/energy_meter_logs/18-12-2021.log
/usr/local/etc/energy_meter_logs/19-12-2021.log
/usr/local/etc/energy_meter_logs/20-12-2021.log
/usr/local/etc/energy_meter_logs/21-12-2021.log
/usr/local/etc/energy_meter_logs/22-12-2021.log
/usr/local/etc/energy_meter_logs/23-12-2021.log
/usr/local/etc/energy_meter_logs/24-12-2021.log
/usr/local/etc/energy_meter_logs/25-12-2021.log
/usr/local/etc/energy_meter_logs/26-12-2021.log
/usr/local/etc/energy_meter_logs/27-12-2021.log
/usr/local/etc/energy_meter_logs/28-12-2021.log
/usr/local/etc/energy_meter_logs/29-12-2021.log
/usr/local/etc/energy_meter_logs/30-12-2021.log
/usr/local/etc/energy_meter_logs/31-12-2021.log

# output (wrong) - I need the output for each day, but it's repeating 31-12-2021,kW
31-12-2021,45.88
01-12-2021
02-12-2021
03-12-2021
04-12-2021
05-12-2021
06-12-2021
07-12-2021
08-12-2021
09-12-2021
10-12-2021
11-12-2021
12-12-2021
13-12-2021
14-12-2021
15-12-2021
16-12-2021
17-12-2021
18-12-2021
19-12-2021
20-12-2021
21-12-2021
22-12-2021
23-12-2021
24-12-2021
25-12-2021
26-12-2021
27-12-2021
28-12-2021
29-12-2021
30-12-2021
31-12-2021,36.24
01-12-2021
02-12-2021
03-12-2021
04-12-2021
05-12-2021
06-12-2021
07-12-2021
08-12-2021
09-12-2021
10-12-2021
11-12-2021
12-12-2021
13-12-2021
14-12-2021
15-12-2021
16-12-2021
17-12-2021
18-12-2021
19-12-2021
20-12-2021
21-12-2021
22-12-2021
23-12-2021
24-12-2021
25-12-2021
26-12-2021
27-12-2021
28-12-2021
29-12-2021
30-12-2021
31-12-2021,28.90