WITH temple AS (SELECT *,
                COUNT(order_id) OVER (PARTITION BY created_at::date) AS zakazov
                FROM tools_shop.orders
                )

SELECT order_id,
       DATE_TRUNC('month', created_at)::date,
       total_amt,
       SUM(zakazov) OVER okno AS cum_zakazov,
       SUM(total_amt) OVER okno AS cum_revenue
       FROM temple
       WINDOW okno AS (ORDER BY created_at::date)